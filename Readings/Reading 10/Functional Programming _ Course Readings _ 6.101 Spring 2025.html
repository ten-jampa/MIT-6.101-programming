<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<!-- This page was generated by CAT-SOOP 19.0.6+hg.14.f36ce1d1.  miau. -->
<meta charset="utf-8">
<title>Functional Programming | Course Readings | 6.101 Spring 2025</title>
<link href="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/logo.gif" rel="icon" type="image/gif">
<!-- include catsoop base css -->
<link href="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/base.css" rel="stylesheet" type="text/css">
<!-- set up JS namespace for catsoop -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    var catsoop = {plugins: {}};

    function toggleResponsiveHeader(){
        document.getElementsByTagName('header')[0].classList.toggle('responsive');
    }

    function toggleAttribute(elt, attr){
        elt.setAttribute(attr, elt.getAttribute(attr) === "true" ? "false" : "true");
    }

    catsoop.topMenuFocus = function(event) {
        var elt = event.target;
        var target = event.relatedTarget;
        if (elt.classList.contains('menu-submenu')){
            var topmenu = elt.parentNode.parentNode;
            if (target && !target.classList.contains("menu-submenu") && target !== topmenu.children[1]) {
                clearMenu(topmenu);
            }
        }else if (!target.classList.contains('cs_top_menu_item')){
            clearMenu(elt.parentNode);
        }
    }

    window.addEventListener('DOMContentLoaded', function(){
        var menu_boxes = document.getElementsByClassName('dropdown-checkbox');
        for(var i=0; i<menu_boxes.length; i++){
            menu_boxes[i].checked = false;
        }
    });

    function clearMenu(menu){
       menu.children[1].checked = false;
    }
    // @license-end
    </script>
<!-- dark mode -->
<script src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/darkreader.min.js" type="text/javascript"></script>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.dark_mode_settings = null;
    if (catsoop.dark_mode_settings === null){
        catsoop.dark_mode_settings = JSON.parse(localStorage.getItem('catsoop_dark_mode_settings'));
        if (catsoop.dark_mode_settings === null){
            catsoop.dark_mode_settings = {'mode': 'disabled', 'brightness': 100, 'contrast': 90, 'sepia': 10, 'grayscale': 0};
        }
    }
    localStorage.setItem('catsoop_dark_mode_settings', JSON.stringify(catsoop.dark_mode_settings));
    catsoop.dark_mode = catsoop.dark_mode_settings.mode;
    delete catsoop.dark_mode_settings.mode;
    if (catsoop.dark_mode === 'enabled' || catsoop.dark_mode === 'auto'){
        DarkReader[catsoop.dark_mode == 'enabled' ? 'enable' : 'auto'](catsoop.dark_mode_settings);
    }
    
    document.addEventListener("DOMContentLoaded", function(event) {
        if (DarkReader.isEnabled()) {
            var invertfilter = 'invert(100%) hue-rotate(180deg)' +
                               ' brightness(' + catsoop.dark_mode_settings.brightness + '%)' +
                               ' contrast(' + catsoop.dark_mode_settings.contrast + '%)' +
                               ' grayscale(' + catsoop.dark_mode_settings.grayscale + '%)' +
                               ' sepia(' + catsoop.dark_mode_settings.sepia + '%)'
            var inverter = document.createElement('style');
            inverter.innerText = 'img.catsoop-darkmode-invert, video.catsoop-darkmode-invert {filter: ' + invertfilter + ';}\n\n'
            document.head.appendChild(inverter);
        }
    });
    // @license-end
    </script>
<!-- load in mathjax and CAT-SOOP-specific math rendering  -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    MathJax = {
      startup: {
        typeset: false,
      }
    }

    catsoop.render_math = function (elt) {
        if(elt.classList.contains('cs_displaymath')){
            var b = "\\[";
            var e = "\\]";
        }else{
            var b = "\\(";
            var e = "\\)";
        }
        elt.innerText = b + elt.innerText + e;
        MathJax.typeset([elt]);
        elt.classList.remove('cs_math_to_render');
    }


    catsoop.render_all_math = function (elt){
        if (elt === null) {
            return;
        }
        var mathelts = elt.getElementsByClassName('cs_math_to_render');
        while(mathelts.length > 0){
            catsoop.render_math(mathelts[0]);
        }
    }
    document.addEventListener("DOMContentLoaded", function(event) {
          catsoop.render_all_math(document);
    });
    // @license-end
    </script>
<script id="MathJax-script" src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/tex-chtml-full-speech.js"></script><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style>
<!-- load in diagram stuff -->
<script src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/cs_diagrams.js" type="text/javascript"></script>
<script type="text/javascript">
        catsoop.diagram_sources = {};
    </script>
<!-- Syntax Highlighting -->
<script src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/highlight.min.js" type="text/javascript"></script>
<script src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/highlightjs-line-numbers.js" type="text/javascript"></script><style type="text/css">.hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}</style>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.syntax_highlighting = function (elt) {
        if (elt === null) {
            return;
        }
        elt.querySelectorAll('pre > code:not(.highlighted)').forEach((block) => {
            hljs.highlightBlock(block);
            var wrap = document.createElement("section");
            wrap.setAttribute("aria-label", "Code block");
            block.parentNode.replaceWith(wrap);
            wrap.append(block.parentNode);
            block.classList.add('highlighted');
        });
        elt.querySelectorAll('code.highlight-lines').forEach(function(b){
            hljs.lineNumbersBlock(b);
            if ((b.innerHTML.trim().match(/\r\n|\r|\n/g) || []).length > 0){
                b.parentElement.style = "padding-left: 0px !important;"
                b.classList.add('hljs');
            }
            b.classList.remove('highlight-lines');
        });
    }
    window.addEventListener('DOMContentLoaded', function(){
        catsoop.syntax_highlighting(document);
    });
    // @license-end
    </script>
<style>
      :root {
        --cs-base-bg-color: #0350ba;
        --cs-light-bg-color: #629ced;
        --cs-base-font-color: #fff;
        --cs-light-font-color: #000;
    }
    </style>
<style>
.cs_top_menu_item {
  font-size: 0.88rem;
}
div.dropdown {
  -moz-transform: translateY(-1px);
}
img {
  max-width:100% !important;
}
.visually-hidden {
	position: absolute !important;
	width: 1px !important;
	height: 1px !important;
	padding: 0 !important;
	margin: -1px !important;
	overflow: hidden !important;
	clip: rect(0,0,0,0) !important;
	white-space: nowrap !important;
	border: 0 !important;
}
kbd {
  background-color: #eee;
  border-radius: 3px;
  border: 1px solid #b4b4b4;
  box-shadow:
    0 1px 1px rgba(0, 0, 0, 0.2),
    0 2px 0 0 rgba(255, 255, 255, 0.7) inset;
  color: #333;
  display: inline-block;
  font-size: 0.85em;
  font-weight: 700;
  line-height: 1;
  padding: 2px 4px;
  white-space: nowrap;
}
</style>
<style>
[id^=cs_qdiv].question-lab101 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101 [id$=nsubmits_left] {
  display: none;
}

[id^=cs_qdiv].question-lab101_vprof [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101_vprof [id$=nsubmits_left] {
  display: none;
}

</style>
<script>
MathJax.options.enableMenu = false;
</script>
<style>
h2.cs_section_title {
   margin-top: 3em;
}
h3.cs_section_title {
   margin-top: 3em;
}
h4.cs_section_title {
   margin-top: 2em;
}
code.hljs {
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
img.envdia {
  border-radius: 5px;
  border: 2px #ccc solid;
}
img.pixels {
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges;
  image-rendering: crisp-edges;
}
button[id$=clearanswer] {
  display: none;
}
.flex { display: flex; flex-wrap: wrap; }
.flex > pre { flex: 1; }
.flex > img { flex: 0 1; }
</style>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function (){
    document.querySelectorAll("img.envdia").forEach(function (b){
        b.classList.add("catsoop-darkmode-invert")
    });
});
</script>
<script src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/multistep.js" type="text/javascript"></script>
<link href="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/multistep.css" rel="stylesheet">
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
document.addEventListener("DOMContentLoaded", function(){
    sessionStorage.setItem("last-non-settings", catsoop.this_path);
});
// @license-end
</script>
<script src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/cs_ajax.js" type="text/javascript"></script>
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
<style id="MJX-CHTML-styles">
mjx-container[jax="CHTML"] {
  line-height: 0;
}

mjx-container [space="1"] {
  margin-left: .111em;
}

mjx-container [space="2"] {
  margin-left: .167em;
}

mjx-container [space="3"] {
  margin-left: .222em;
}

mjx-container [space="4"] {
  margin-left: .278em;
}

mjx-container [space="5"] {
  margin-left: .333em;
}

mjx-container [rspace="1"] {
  margin-right: .111em;
}

mjx-container [rspace="2"] {
  margin-right: .167em;
}

mjx-container [rspace="3"] {
  margin-right: .222em;
}

mjx-container [rspace="4"] {
  margin-right: .278em;
}

mjx-container [rspace="5"] {
  margin-right: .333em;
}

mjx-container [size="s"] {
  font-size: 70.7%;
}

mjx-container [size="ss"] {
  font-size: 50%;
}

mjx-container [size="Tn"] {
  font-size: 60%;
}

mjx-container [size="sm"] {
  font-size: 85%;
}

mjx-container [size="lg"] {
  font-size: 120%;
}

mjx-container [size="Lg"] {
  font-size: 144%;
}

mjx-container [size="LG"] {
  font-size: 173%;
}

mjx-container [size="hg"] {
  font-size: 207%;
}

mjx-container [size="HG"] {
  font-size: 249%;
}

mjx-container [width="full"] {
  width: 100%;
}

mjx-box {
  display: inline-block;
}

mjx-block {
  display: block;
}

mjx-itable {
  display: inline-table;
}

mjx-row {
  display: table-row;
}

mjx-row > * {
  display: table-cell;
}

mjx-mtext {
  display: inline-block;
}

mjx-mstyle {
  display: inline-block;
}

mjx-merror {
  display: inline-block;
  color: red;
  background-color: yellow;
}

mjx-mphantom {
  visibility: hidden;
}

_::-webkit-full-page-media, _:future, :root mjx-container {
  will-change: opacity;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-math {
  display: inline-block;
  text-align: left;
  line-height: 0;
  text-indent: 0;
  font-style: normal;
  font-weight: normal;
  font-size: 100%;
  font-size-adjust: none;
  letter-spacing: normal;
  border-collapse: collapse;
  word-wrap: normal;
  word-spacing: normal;
  white-space: nowrap;
  direction: ltr;
  padding: 1px 0;
}

mjx-container[jax="CHTML"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="CHTML"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="CHTML"][display="true"] mjx-math {
  padding: 0;
}

mjx-container[jax="CHTML"][justify="left"] {
  text-align: left;
}

mjx-container[jax="CHTML"][justify="right"] {
  text-align: right;
}

mjx-mo {
  display: inline-block;
  text-align: left;
}

mjx-stretchy-h {
  display: inline-table;
  width: 100%;
}

mjx-stretchy-h > * {
  display: table-cell;
  width: 0;
}

mjx-stretchy-h > * > mjx-c {
  display: inline-block;
  transform: scalex(1.0000001);
}

mjx-stretchy-h > * > mjx-c::before {
  display: inline-block;
  width: initial;
}

mjx-stretchy-h > mjx-ext {
  /* IE */ overflow: hidden;
  /* others */ overflow: clip visible;
  width: 100%;
}

mjx-stretchy-h > mjx-ext > mjx-c::before {
  transform: scalex(500);
}

mjx-stretchy-h > mjx-ext > mjx-c {
  width: 0;
}

mjx-stretchy-h > mjx-beg > mjx-c {
  margin-right: -.1em;
}

mjx-stretchy-h > mjx-end > mjx-c {
  margin-left: -.1em;
}

mjx-stretchy-v {
  display: inline-block;
}

mjx-stretchy-v > * {
  display: block;
}

mjx-stretchy-v > mjx-beg {
  height: 0;
}

mjx-stretchy-v > mjx-end > mjx-c {
  display: block;
}

mjx-stretchy-v > * > mjx-c {
  transform: scaley(1.0000001);
  transform-origin: left center;
  overflow: hidden;
}

mjx-stretchy-v > mjx-ext {
  display: block;
  height: 100%;
  box-sizing: border-box;
  border: 0px solid transparent;
  /* IE */ overflow: hidden;
  /* others */ overflow: visible clip;
}

mjx-stretchy-v > mjx-ext > mjx-c::before {
  width: initial;
  box-sizing: border-box;
}

mjx-stretchy-v > mjx-ext > mjx-c {
  transform: scaleY(500) translateY(.075em);
  overflow: visible;
}

mjx-mark {
  display: inline-block;
  height: 0px;
}

mjx-c {
  display: inline-block;
}

mjx-utext {
  display: inline-block;
  padding: .75em 0 .2em 0;
}

mjx-mn {
  display: inline-block;
  text-align: left;
}

mjx-mi {
  display: inline-block;
  text-align: left;
}

mjx-c::before {
  display: block;
  width: 0;
}

.MJX-TEX {
  font-family: MJXZERO, MJXTEX;
}

.TEX-B {
  font-family: MJXZERO, MJXTEX-B;
}

.TEX-I {
  font-family: MJXZERO, MJXTEX-I;
}

.TEX-MI {
  font-family: MJXZERO, MJXTEX-MI;
}

.TEX-BI {
  font-family: MJXZERO, MJXTEX-BI;
}

.TEX-S1 {
  font-family: MJXZERO, MJXTEX-S1;
}

.TEX-S2 {
  font-family: MJXZERO, MJXTEX-S2;
}

.TEX-S3 {
  font-family: MJXZERO, MJXTEX-S3;
}

.TEX-S4 {
  font-family: MJXZERO, MJXTEX-S4;
}

.TEX-A {
  font-family: MJXZERO, MJXTEX-A;
}

.TEX-C {
  font-family: MJXZERO, MJXTEX-C;
}

.TEX-CB {
  font-family: MJXZERO, MJXTEX-CB;
}

.TEX-FR {
  font-family: MJXZERO, MJXTEX-FR;
}

.TEX-FRB {
  font-family: MJXZERO, MJXTEX-FRB;
}

.TEX-SS {
  font-family: MJXZERO, MJXTEX-SS;
}

.TEX-SSB {
  font-family: MJXZERO, MJXTEX-SSB;
}

.TEX-SSI {
  font-family: MJXZERO, MJXTEX-SSI;
}

.TEX-SC {
  font-family: MJXZERO, MJXTEX-SC;
}

.TEX-T {
  font-family: MJXZERO, MJXTEX-T;
}

.TEX-V {
  font-family: MJXZERO, MJXTEX-V;
}

.TEX-VB {
  font-family: MJXZERO, MJXTEX-VB;
}

mjx-stretchy-v mjx-c, mjx-stretchy-h mjx-c {
  font-family: MJXZERO, MJXTEX-S1, MJXTEX-S4, MJXTEX, MJXTEX-A ! important;
}

@font-face /* 0 */ {
  font-family: MJXZERO;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Zero.woff") format("woff");
}

@font-face /* 1 */ {
  font-family: MJXTEX;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Main-Regular.woff") format("woff");
}

@font-face /* 2 */ {
  font-family: MJXTEX-B;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Main-Bold.woff") format("woff");
}

@font-face /* 3 */ {
  font-family: MJXTEX-I;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Math-Italic.woff") format("woff");
}

@font-face /* 4 */ {
  font-family: MJXTEX-MI;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Main-Italic.woff") format("woff");
}

@font-face /* 5 */ {
  font-family: MJXTEX-BI;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Math-BoldItalic.woff") format("woff");
}

@font-face /* 6 */ {
  font-family: MJXTEX-S1;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Size1-Regular.woff") format("woff");
}

@font-face /* 7 */ {
  font-family: MJXTEX-S2;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Size2-Regular.woff") format("woff");
}

@font-face /* 8 */ {
  font-family: MJXTEX-S3;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Size3-Regular.woff") format("woff");
}

@font-face /* 9 */ {
  font-family: MJXTEX-S4;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Size4-Regular.woff") format("woff");
}

@font-face /* 10 */ {
  font-family: MJXTEX-A;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_AMS-Regular.woff") format("woff");
}

@font-face /* 11 */ {
  font-family: MJXTEX-C;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Regular.woff") format("woff");
}

@font-face /* 12 */ {
  font-family: MJXTEX-CB;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Bold.woff") format("woff");
}

@font-face /* 13 */ {
  font-family: MJXTEX-FR;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Fraktur-Regular.woff") format("woff");
}

@font-face /* 14 */ {
  font-family: MJXTEX-FRB;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Fraktur-Bold.woff") format("woff");
}

@font-face /* 15 */ {
  font-family: MJXTEX-SS;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_SansSerif-Regular.woff") format("woff");
}

@font-face /* 16 */ {
  font-family: MJXTEX-SSB;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_SansSerif-Bold.woff") format("woff");
}

@font-face /* 17 */ {
  font-family: MJXTEX-SSI;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_SansSerif-Italic.woff") format("woff");
}

@font-face /* 18 */ {
  font-family: MJXTEX-SC;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Script-Regular.woff") format("woff");
}

@font-face /* 19 */ {
  font-family: MJXTEX-T;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Typewriter-Regular.woff") format("woff");
}

@font-face /* 20 */ {
  font-family: MJXTEX-V;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Vector-Regular.woff") format("woff");
}

@font-face /* 21 */ {
  font-family: MJXTEX-VB;
  src: url("https://py.mit.edu/_static/_base/js/mathjax/output/chtml/fonts/woff-v2/MathJax_Vector-Bold.woff") format("woff");
}

mjx-c.mjx-c28::before {
  padding: 0.75em 0.389em 0.25em 0;
  content: "(";
}

mjx-c.mjx-c31::before {
  padding: 0.666em 0.5em 0 0;
  content: "1";
}

mjx-c.mjx-c30::before {
  padding: 0.666em 0.5em 0.022em 0;
  content: "0";
}

mjx-c.mjx-c2212::before {
  padding: 0.583em 0.778em 0.082em 0;
  content: "\2212";
}

mjx-c.mjx-c1D45B.TEX-I::before {
  padding: 0.442em 0.6em 0.011em 0;
  content: "n";
}

mjx-c.mjx-c29::before {
  padding: 0.75em 0.389em 0.25em 0;
  content: ")";
}
</style></head>
<body style="margin: 0px;">
<header id="cs_header">
<div aria-role="menubar" class="nav-container">
<div class="cs_header_text"><a href="https://py.mit.edu/spring25"><img src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/logo.gif">&nbsp;6.101</a></div>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_c1a43e3f699a1ed71997b0321c2e9ffd">Information<span aria-hidden="true" class="downarrow">▼</span></label>
<input class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_c1a43e3f699a1ed71997b0321c2e9ffd" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox">
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/basics" onblur="catsoop.topMenuFocus(event);" role="menuitem">Basics and Schedule</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/grading" onblur="catsoop.topMenuFocus(event);" role="menuitem">Grading Policies</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/academic_integrity" onblur="catsoop.topMenuFocus(event);" role="menuitem">Academic Integrity</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/help" onblur="catsoop.topMenuFocus(event);" role="menuitem">Getting Help</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/infrastructure" onblur="catsoop.topMenuFocus(event);" role="menuitem">Infrastructure</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/staff" onblur="catsoop.topMenuFocus(event);" role="menuitem">Staff List</a></div></div>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_ee51a2d5002bd02613936bd9b2f3dbee">Materials<span aria-hidden="true" class="downarrow">▼</span></label>
<input class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_ee51a2d5002bd02613936bd9b2f3dbee" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox">
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/calendar" onblur="catsoop.topMenuFocus(event);" role="menuitem">Calendar</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/readings" onblur="catsoop.topMenuFocus(event);" role="menuitem">Readings</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/labs" onblur="catsoop.topMenuFocus(event);" role="menuitem">Labs</a></div></div>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring25/progress" onblur="catsoop.topMenuFocus(event);" role="menuitem">Progress</a>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring25/queue" onblur="catsoop.topMenuFocus(event);" role="menuitem">Queue</a>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_e7491ca7d6e92640dcbee54ca3f94478">tjampa<span aria-hidden="true" class="downarrow">▼</span></label>
<input class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_e7491ca7d6e92640dcbee54ca3f94478" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox">
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/ssh_keys" onblur="catsoop.topMenuFocus(event);" role="menuitem">Manage SSH Keys</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/_util/user_settings" onblur="catsoop.topMenuFocus(event);" role="menuitem">Settings</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/readings/functional_programming?loginaction=logout" onblur="catsoop.topMenuFocus(event);" role="menuitem">Log Out</a></div></div><a class="icon" href="javascript:void(0);" onclick="toggleResponsiveHeader()" aria-label="site-menu">☰</a>
</div>
</header>
<nav aria-label="Breadcrumbs" class="cs_navigation cs_top_navigation" id="cs_breadcrumbs"><li><a href="https://py.mit.edu/spring25">Home</a></li><li><a href="https://py.mit.edu/spring25/readings">Course Readings</a></li><li><a href="https://py.mit.edu/spring25/readings/functional_programming">Functional Programming</a></li></nav>
<div class="cs_body" id="cs_body">
<div class="cs_left_menu"></div>
<div class="cs_content">
<div class="cs_page_body" role="main">
<center><h1 class="cs_content_header">Functional Programming</h1></center>
<div class="callout callout-warning" markdown="">
<p>This reading is relatively new, and your feedback will help us
improve it!  If you notice mistakes (big or small), if you have questions, if
anything is unclear, if there are things not covered here that you'd like to
see covered, or if you have any other suggestions; please get in touch during
office hours or open lab hours, or via e-mail at <code>6.101-help@mit.edu</code>.</p>
</div>
<div class="callout callout-note"><div class="callout-title">Note</div>
<p>All questions on this page are due at 10:00pm on Sunday, 27 April.</p>
</div>
<h2 aria-hidden="true">Table of Contents</h2><ul aria-label="Table of Contents" role="navigation"><li><a href="#_introduction">1) Introduction</a></li><li><a href="#_more_iteration_to_recursion">2) More Iteration to Recursion</a></li><li><a href="#_classes_to_functions">3) Classes to Functions</a></li><ul><li><a href="#_aside_nonlocal">3.1) Aside: <code>nonlocal</code></a></li></ul><li><a href="#_memoization">4) Memoization</a></li></ul>
<p><a class="anchor" name="catsoop_section_1"></a><a class="anchor" name="_introduction"></a></p><h2 class="cs_section_title">1) Introduction<a class="cs_permalink" href="#_introduction">§</a></h2><p></p>
<p>Functions were one of the first Python features that we <a href="https://py.mit.edu/spring25/readings/functions">studied</a>
this semester, but they are a remarkably versatile feature that deserves more
attention.  <a href="https://en.wikipedia.org/wiki/Functional_programming"><em>Functional
programming</em></a> is a
classic programming style heavily focused on functions.  As recently as the
mid-2000s, functional programming was seen by industry as a niche academic
idea, but, in the mean time, it went quite mainstream.  While it was originally
associated with distinct programming languages like
<a href="https://en.wikipedia.org/wiki/Haskell">Haskell</a>, many of its best ideas were
adopted by better-known languages like Python.  We've been using those features
(like <code>lambda</code>) all along this semester, and this reading will show you even
more handy patterns in functional programming.</p>
<p>As it happens, one of the first programming languages that worked on multiple
different kinds of computers was
<a href="https://en.wikipedia.org/wiki/Lisp_(programming_language)">LISP</a>, and it
arguably introduced functional programming as a practical style, way back in
1958.  This week's lab will lead you through implementing your own subset of
LISP.  Getting a better understanding of functions and their uses is also
directly relevant to that experience.</p>
<p><a class="anchor" name="catsoop_section_2"></a><a class="anchor" name="_more_iteration_to_recursion"></a></p><h2 class="cs_section_title">2) More Iteration to Recursion<a class="cs_permalink" href="#_more_iteration_to_recursion">§</a></h2><p></p>
<p>One interesting feature of LISP is that it does not feature any looping
structures (there are no <code>for</code> or <code>while</code> loops).  But it does have functions,
and, <a href="https://py.mit.edu/spring25/readings/recursion2">as we've seen before</a>, it's possible to use functions to
implement loops.  One of the first examples we looked at, factorial, could
always be written with a loop like so:</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">factorial</span>(<span class="hljs-params">n</span>):</span>
    result = <span class="hljs-number">1</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):
        result *= i
    <span class="hljs-keyword">return</span> result
</code></pre></section>
<p>But we also learned that it can be written recursively as a one-liner.</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">factorial</span>(<span class="hljs-params">n</span>):</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> n &lt;= <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> n * factorial(n<span class="hljs-number">-1</span>)
</code></pre></section>
<p>In LISP, every function needs to be written in this style, effectively as a
single <code>return</code> with an expression that does all the heavy lifting!</p>
<p>Consider this example, which capitalizes all words in a list:</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">all_caps_list</span>(<span class="hljs-params">words</span>):</span>
    <span class="hljs-keyword">return</span> [w.upper() <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> words]
</code></pre></section>
<p>We can apply another of our recursion patterns, the <strong>first/rest</strong>
decomposition, to write a recursive version.</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">all_caps_list</span>(<span class="hljs-params">words</span>):</span>
    <span class="hljs-keyword">if</span> len(words) == <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> words[<span class="hljs-number">0</span>].upper()
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> [words[<span class="hljs-number">0</span>].upper()] + all_caps_list(words[<span class="hljs-number">1</span>:])
</code></pre></section>
<p>
<!--START question all_caps_list --></p><section aria-label="Question">
<div class="question question-multiplechoice" id="cs_qdiv_all_caps_list" style="position: static">
<div id="all_caps_list_rendered_question">
<div id="catsoop_preamble_all_caps_list"></div>
<div id="catsoop_prompt_all_caps_list" style="display: inline;">How does this recursive version behave on lists of strings?<br></div>
<select aria-labelledby="catsoop_prompt_all_caps_list" id="all_caps_list" name="all_caps_list">
<option value="-1">--</option>
<option value="0">It works as expected.</option>
<option value="1">It contains a Python syntax error.</option>
<option selected="selected" value="2">It will raise an exception when it runs.</option>
<option value="3">It will return wrong answers.</option></select>
</div><div>
<span id="all_caps_list_buttons">
<button class="submit btn btn-catsoop" id="all_caps_list_submit" onclick="catsoop.submit('all_caps_list');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="all_caps_list_clearanswer" onclick="catsoop.clearanswer('all_caps_list');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="all_caps_list_loading_wrapper" role="status">
<span id="all_caps_list_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="all_caps_list_score_display" role="status"></span>
<div class="nsubmits_left" id="all_caps_list_nsubmits_left" role="status">You have submitted this assignment 1 time.</div></div>
<div class="solution" id="all_caps_list_solution_container">
<div id="all_caps_list_solution">
<b>Solution:</b> It will raise an exception when it runs.
</div>
<div id="all_caps_list_solution_explanation"><hr><p><b>Explanation:</b></p>
<p>Something is off in the base case: it returns a string instead of a 
list, so the recursive case tries to add a list to a string.
The result is an exception.
We could fix it by putting extra square brackets around the return value
 in the base case, but actually we can do even better by adopting a 
simpler base case.</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">all_caps_list</span>(<span class="hljs-params">words</span>):</span>
    <span class="hljs-keyword">if</span> len(words) == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> []
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> [words[<span class="hljs-number">0</span>].upper()] + all_caps_list(words[<span class="hljs-number">1</span>:])
</code></pre></section>
</div>
</div>
<div aria-atomic="true" id="all_caps_list_message" role="status"><img alt="Correct" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="></div>
</div>
</section>
<!--END question all_caps_list -->
<p></p>
<p>It may be surprising how many loops can be turned into instances of recursion.
Consider this basic one.</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(n):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'hello'</span>, i)
</code></pre></section>
<p>This structure might seem a little bit trickier to implement using recursion,
but we'll see that we can indeed do it, using a <strong>higher-order function</strong>
(meaning a function that takes a function as input).  Here, we encode what was
the body of our loop (i.e., the thing we want to repeat multiple times) as a
function; then we call that function repeatedly, using recursion to keep track
of how many times we still need to run that code.</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">repeat_n_times</span>(<span class="hljs-params">n, func</span>):</span>
    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span>
    func(n)
    repeat_n_times(n<span class="hljs-number">-1</span>, func)
</code></pre></section>
<p>
<!--START question repeat_n_times --></p><section aria-label="Question">
<div class="question question-multiplechoice" id="cs_qdiv_repeat_n_times" style="position: static">
<div id="repeat_n_times_rendered_question">
<div id="catsoop_preamble_repeat_n_times"></div>
<div id="catsoop_prompt_repeat_n_times" style="display: inline;">What happens when we call <code>repeat_n_times(20, lambda i: print('hello', i))</code>?<br></div>
<select aria-labelledby="catsoop_prompt_repeat_n_times" id="repeat_n_times" name="repeat_n_times">
<option value="-1">--</option>
<option value="0">It works as expected.</option>
<option value="1">It contains a Python syntax error.</option>
<option value="2">It will raise an exception when it runs.</option>
<option selected="selected" value="3">It will print different values than the original does.</option></select>
</div><div>
<span id="repeat_n_times_buttons">
<button class="submit btn btn-catsoop" id="repeat_n_times_submit" onclick="catsoop.submit('repeat_n_times');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="repeat_n_times_clearanswer" onclick="catsoop.clearanswer('repeat_n_times');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="repeat_n_times_loading_wrapper" role="status">
<span id="repeat_n_times_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="repeat_n_times_score_display" role="status"></span>
<div class="nsubmits_left" id="repeat_n_times_nsubmits_left" role="status">You have submitted this assignment 1 time.</div></div>
<div class="solution" id="repeat_n_times_solution_container">
<div id="repeat_n_times_solution">
<b>Solution:</b> It will print different values than the original does.
</div>
<div id="repeat_n_times_solution_explanation"><hr><p><b>Explanation:</b></p>
<p>Whoops, this version counts down <em>backward</em> and stops at one instead of zero!
We can fix it using our pattern of adding a <code>sofar</code> argument.</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">repeat_n_times</span>(<span class="hljs-params">n, func, sofar=<span class="hljs-number">0</span></span>):</span>
    <span class="hljs-keyword">if</span> sofar == n:
        <span class="hljs-keyword">return</span>
    func(sofar)
    repeat_n_times(n, func, sofar+<span class="hljs-number">1</span>)
</code></pre></section>
<p>There is also a fancier solution that even better shows off the power of
functions as data.  Do you see why this version works, too?</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">repeat_n_times</span>(<span class="hljs-params">n, func</span>):</span>
    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span>
    func(<span class="hljs-number">0</span>)
    repeat_n_times(n<span class="hljs-number">-1</span>, <span class="hljs-keyword">lambda</span> x: func(x+<span class="hljs-number">1</span>))
</code></pre></section>
</div>
</div>
<div aria-atomic="true" id="repeat_n_times_message" role="status"><img alt="Correct" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="></div>
</div>
</section>
<!--END question repeat_n_times -->
<p></p>
<p><a class="anchor" name="catsoop_section_3"></a><a class="anchor" name="_classes_to_functions"></a></p><h2 class="cs_section_title">3) Classes to Functions<a class="cs_permalink" href="#_classes_to_functions">§</a></h2><p></p>
<p>Object-oriented programming, e.g. with classes in Python, is commonly used in industry
as a way to organize complex code bases.  However,
essentially any use of classes can be reimplemented with functions in Python.
Let's look at two examples.</p>
<p>We can build a simple "bank" class that helps us maintain multiple named
numeric balances.</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bank</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>
        self.accounts = {}

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">balance_of</span>(<span class="hljs-params">self, account</span>):</span>
        <span class="hljs-keyword">return</span> self.accounts.get(account, <span class="hljs-number">0</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deposit</span>(<span class="hljs-params">self, account, amount</span>):</span>
        self.accounts[account] = self.balance_of(account) + amount
</code></pre></section>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-meta">&gt;&gt;&gt; </span>b = Bank()
<span class="hljs-meta">&gt;&gt;&gt; </span>b.deposit(<span class="hljs-string">'Steve'</span>, <span class="hljs-number">3</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span>b.deposit(<span class="hljs-string">'Magdalena'</span>, <span class="hljs-number">4</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span>b.deposit(<span class="hljs-string">'Steve'</span>, <span class="hljs-number">5</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span>b.balance_of(<span class="hljs-string">'Steve'</span>)
<span class="hljs-number">8</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>b.balance_of(<span class="hljs-string">'Magdalena'</span>)
<span class="hljs-number">4</span>
</code></pre></section>
<p>The chance to <em>encapsulate</em> the details of balance maintenance within a class
pays off when it comes to writing and maintaining programs.  However, functions
also provide us all the ingredients we need to the same end.  Consider the
following code:</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bank</span>():</span>
    accounts = {}

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">balance_of</span>(<span class="hljs-params">account</span>):</span>
        <span class="hljs-keyword">return</span> accounts.get(account, <span class="hljs-number">0</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deposit</span>(<span class="hljs-params">account, amount</span>):</span>
        accounts[account] = balance_of(account) + amount

    <span class="hljs-keyword">return</span> balance_of, deposit
</code></pre></section>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-meta">&gt;&gt;&gt; </span>balance_of, deposit = bank()
<span class="hljs-meta">&gt;&gt;&gt; </span>deposit(<span class="hljs-string">'Steve'</span>, <span class="hljs-number">3</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span>deposit(<span class="hljs-string">'Magdalena'</span>, <span class="hljs-number">4</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span>deposit(<span class="hljs-string">'Steve'</span>, <span class="hljs-number">5</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span>balance_of(<span class="hljs-string">'Steve'</span>)
<span class="hljs-number">8</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>balance_of(<span class="hljs-string">'Magdalena'</span>)
<span class="hljs-number">4</span>
</code></pre></section>
<p>It's important that the two functions that <code>bank()</code> returns, <code>balance_of</code> and
<code>deposit</code>, share a freshly created enclosing frame with a new <code>accounts</code>
dictionary.  This frame is equivalent to the object in the object-oriented version.
If the details there are not clear, try drawing an environment diagram.</p>
<p><a class="anchor" name="catsoop_section_3_1"></a><a class="anchor" name="_aside_nonlocal"></a></p><h3 class="cs_section_title">3.1) Aside: <code>nonlocal</code><a class="cs_permalink" href="#_aside_nonlocal">§</a></h3><p></p>
<p>So far it looks like we'll have smooth sailing converting classes into
functions.  Here's a simpler example than the bank -- a counter that we can keep
incrementing by one.  But it reveals a subtle issue in Python with using variables
from an enclosing frame to store information.</p>
<section aria-label="Code block"><button role="button" aria-pressed="true" class="catsoop-code-showhide">Show/Hide Line Numbers</button><pre style="padding-left: 0px !important;"><code class="language-python hljs highlighted"><div class="catsoop-code-display hljs-ln"><div class="catsoop-code-line"><span class="hljs-ln-line hljs-ln-numbers" data-line-number="1">1</span><span class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">counter</span>():</span></span></div><div class="catsoop-code-line"><span class="hljs-ln-line hljs-ln-numbers" data-line-number="2">2</span><span class="hljs-ln-line hljs-ln-code" data-line-number="2">    tally = <span class="hljs-number">0</span></span></div><div class="catsoop-code-line"><span class="hljs-ln-line hljs-ln-numbers" data-line-number="3">3</span><span class="hljs-ln-line hljs-ln-code" data-line-number="3"> </span></div><div class="catsoop-code-line"><span class="hljs-ln-line hljs-ln-numbers" data-line-number="4">4</span><span class="hljs-ln-line hljs-ln-code" data-line-number="4">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">increment</span>():</span></span></div><div class="catsoop-code-line"><span class="hljs-ln-line hljs-ln-numbers" data-line-number="5">5</span><span class="hljs-ln-line hljs-ln-code" data-line-number="5">        tally += <span class="hljs-number">1</span></span></div><div class="catsoop-code-line"><span class="hljs-ln-line hljs-ln-numbers" data-line-number="6">6</span><span class="hljs-ln-line hljs-ln-code" data-line-number="6">        <span class="hljs-keyword">return</span> tally</span></div><div class="catsoop-code-line"><span class="hljs-ln-line hljs-ln-numbers" data-line-number="7">7</span><span class="hljs-ln-line hljs-ln-code" data-line-number="7"> </span></div><div class="catsoop-code-line"><span class="hljs-ln-line hljs-ln-numbers" data-line-number="8">8</span><span class="hljs-ln-line hljs-ln-code" data-line-number="8">    <span class="hljs-keyword">return</span> increment</span></div></div></code></pre></section>
<p>
<!--START question counter --></p><section aria-label="Question">
<div class="question question-multiplechoice" id="cs_qdiv_counter" style="position: static">
<div id="counter_rendered_question">
<div id="catsoop_preamble_counter"></div>
<div id="catsoop_prompt_counter" style="display: inline;">Consider running <code>inc = counter()</code> and then repeatedly calling <code>inc()</code>.  What happens when we do this?<br></div>
<select aria-labelledby="catsoop_prompt_counter" id="counter" name="counter">
<option value="-1">--</option>
<option value="0">It works as expected.</option>
<option value="1">The code has a Python syntax error to begin with.</option>
<option selected="selected" value="2">It will raise an exception when it runs.</option>
<option value="3">It will return incorrect values.</option></select>
</div><div>
<span id="counter_buttons">
<button class="submit btn btn-catsoop" id="counter_submit" onclick="catsoop.submit('counter');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="counter_clearanswer" onclick="catsoop.clearanswer('counter');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="counter_loading_wrapper" role="status">
<span id="counter_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="counter_score_display" role="status"></span>
<div class="nsubmits_left" id="counter_nsubmits_left" role="status">You have submitted this assignment 3 times.</div></div>
<div class="solution" id="counter_solution_container">
<div id="counter_solution">
<b>Solution:</b> It will raise an exception when it runs.
</div>
<div id="counter_solution_explanation"><hr><p><b>Explanation:</b></p>
<p>Specifically, on line 5 <code>tally += 1</code>, we will get this error:</p>
<section aria-label="Code block"><pre><code class="nohighlight highlighted">UnboundLocalError: cannot access local variable 'tally' where it is not associated with a value
</code></pre></section>
</div>
</div>
<div aria-atomic="true" id="counter_message" role="status"><img alt="Correct" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="></div>
</div>
</section>
<!--END question counter -->
<p></p>
<p>This code exhibits a common pitfall in Python.
Namely, variable <code>tally</code> in <code>increment</code> is being treated as <em>local</em> to that
function rather than inherited from the enclosing frame.
Why?</p>
<p>Because when a function <em>modifies</em> a variable, Python forces the variable to be
present directly in the function's frame... but here <code>tally</code> was not
initialized locally, so Python complains that <code>tally</code> does not exist.</p>
<p>But Python gives us a way to control this.  In particular, if we <em>want</em> to use
the variable <code>tally</code> from the enclosing frame inside of <code>increment</code>, we can
accomplish this using the <code>nonlocal</code> keyword:</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">counter</span>():</span>
    tally = <span class="hljs-number">0</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">increment</span>():</span>
        <span class="hljs-keyword">nonlocal</span> tally
        tally += <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> tally

    <span class="hljs-keyword">return</span> increment
</code></pre></section>
<p>The line <code>nonlocal tally</code> tells Python that whenever we refer to the name
<code>tally</code> inside of <code>increment</code> (whether we're just looking up the value <em>or</em>
setting/changing it), we should always be looking for the variable in one of our parent
frames, instead of in the local frame for calling <code>increment</code>.</p>
<div class="question"><b>Check Yourself:</b><p>Look back at the <code>bank</code> example from above:
</p><section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bank</span>():</span>
    accounts = {}

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">balance_of</span>(<span class="hljs-params">account</span>):</span>
        <span class="hljs-keyword">return</span> accounts.get(account, <span class="hljs-number">0</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deposit</span>(<span class="hljs-params">account, amount</span>):</span>
        accounts[account] = balance_of(account) + amount

    <span class="hljs-keyword">return</span> balance_of, deposit
</code></pre></section>
<p>The functions <code>balance_of</code> and <code>deposit</code> are using <code>accounts</code> from their enclosing frame to update the balances of bank accounts.</p>
<p>What's the difference between the way <code>bank</code> uses a variable from an enclosing frame and the way that <code>counter</code> does?
Why does <code>counter</code> need <code>nonlocal tally</code>, but <code>bank</code> doesn't need to say <code>nonlocal accounts</code>?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>The functions in <code>bank</code> only <em>read</em> the value of the <code>accounts</code> variable, to reach the dictionary of accounts.  The dictionary is mutated by <code>deposit</code>, but this doesn't involve reassigning the <code>accounts</code> variable itself.
<p>By contrast, <code>counter</code> needs to <em>reassign</em> the <code>tally</code> variable itself.  So you need to use <code>nonlocal</code> when you will assign to a variable in an enclosing frame, but not when you just need to use the variable's value.
</p></div></div><p></p><p><span id="queue_checkyourself_1"></span></p></div>
<p><a class="anchor" name="catsoop_section_4"></a><a class="anchor" name="_memoization"></a></p><h2 class="cs_section_title">4) Memoization<a class="cs_permalink" href="#_memoization">§</a></h2><p></p>
<p>We can also use higher-order functions to improve the performance of naive
code.  Here's a classic of recursion, a calculator for <a href="https://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci
numbers</a>.</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span>(<span class="hljs-params">n</span>):</span>
    <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> n
    <span class="hljs-keyword">return</span> fib(n<span class="hljs-number">-2</span>) + fib(n<span class="hljs-number">-1</span>)
</code></pre></section>
<div class="question"><b>Check Yourself:</b><p></p><p>Roughly how long will it take to compute <code>fib(100)</code>?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>It turns out that this will take a <em>really</em> long time!  Not only will it not
be finished if we step out to get a coffee or a sandwich, but it won't be
finished if we come back in a month, or a year, or even a decade.  In fact,
we expect this program, as written, to take longer than the estimated remaining
life of the universe, even if we had a really fast computer.
<p>What's causing this to be so slow?  Read on to find out!</p></div></div>
<p></p><p><span id="queue_checkyourself_2"></span></p></div>
<p>We can start to see why this is so slow by looking at a tree showing the
recursive calls that are made when computing <code>fib(100)</code>.  We start with a
single top-level call:</p>
<center>
<img class="envdia catsoop-darkmode-invert" src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/fibtree1.png" width="400">
</center>
<p>That then makes two recursive calls:</p>
<center>
<img class="envdia catsoop-darkmode-invert" src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/fibtree2.png" width="400">
</center>
<p>Each of those makes two recursive calls:</p>
<center>
<img class="envdia catsoop-darkmode-invert" src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/fibtree3.png" width="400">
</center>
<p>And this pattern continues:</p>
<center>
<img class="envdia catsoop-darkmode-invert" src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/fibtree4.png" width="400">
</center>
<p>
<!--START question fib_num_94 --></p><section aria-label="Question">
<div class="question question-pythonic" id="cs_qdiv_fib_num_94" style="position: static">
<div id="fib_num_94_rendered_question">
<div id="catsoop_preamble_fib_num_94"></div>
<div id="catsoop_prompt_fib_num_94" style="display: inline;">How many times will we ultimately make a call computing the 94<sup>th</sup> Fibonacci number, like <code>fib(94)</code>, in the structure above?  Enter your answer as an integer below:<br></div><input aria-labelledby="catsoop_prompt_fib_num_94" id="fib_num_94" name="fib_num_94" size="50" type="text" value="13">
</div><div>
<span id="fib_num_94_buttons">
<button class="submit btn btn-catsoop" id="fib_num_94_submit" onclick="catsoop.submit('fib_num_94');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="fib_num_94_clearanswer" onclick="catsoop.clearanswer('fib_num_94');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="fib_num_94_loading_wrapper" role="status">
<span id="fib_num_94_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="fib_num_94_score_display" role="status"></span>
<div class="nsubmits_left" id="fib_num_94_nsubmits_left" role="status">You have submitted this assignment 3 times.</div></div>
<div class="solution" id="fib_num_94_solution_container">
<div id="fib_num_94_solution">
<p><b>Solution:</b> <tt>13</tt></p><p>
</p><p></p>
</div>
<div id="fib_num_94_solution_explanation"><hr><p><b>Explanation:</b></p>
<p>Indeed, we call <code>fib(94)</code> 13 times during this process.
That's a lot of duplication!  And, in fact, there's a lot of duplication
elsewhere within the tree as well!</p>
<p>It's an edifying exercise to tally up how many calls each number receives:</p>
<table border="1">
<tbody><tr> <th>Argument</th> <th>#Calls</th> </tr>
<tr> <td>100</td> <td>1</td> </tr>
<tr> <td>99</td> <td>1</td> </tr>
<tr> <td>98</td> <td>2</td> </tr>
<tr> <td>97</td> <td>3</td> </tr>
<tr> <td>96</td> <td>5</td> </tr>
<tr> <td>95</td> <td>8</td> </tr>
<tr> <td>94</td> <td>13</td> </tr>
</tbody></table>
<p>Do you see an interesting pattern?  The call counts replicate the Fibonacci
numbers themselves!  Specifically, the call count for <code>fib(n)</code> in the recursion
is equal to the <span class=""><mjx-container class="MathJax" jax="CHTML" style="font-size: 119.1%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>100</mn><mo>−</mo><mi>n</mi><mo stretchy="false">)</mo></math></mjx-assistive-mml></mjx-container></span>th Fibonacci number.  Looking down at the bottom of
the recusion, the base case <code>fib(0)</code> will be called a number of times equal to
the 100th Fibonacci number.  Since that number <code>fib(100)</code> is a gigantic number,
we will make a gigantic number of recursive calls, which ultimately means that
this computation, as expressed above, is not really feasible.</p>
</div>
</div>
<div aria-atomic="true" id="fib_num_94_message" role="status"><img alt="Correct" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="><br></div>
</div>
</section>
<!--END question fib_num_94 -->
<p></p>
<p>But there's something interesting here, which we can exploit: even though we're
calling <code>fib(94)</code> multiple times, the result is always the same.  But in order
to find that result (as things are currently written), Python needs to explore
the <em>entire</em> subtree of the drawing above that's rooted at <code>94</code>, which takes a
<em>long time</em>.</p>
<p>We can see some of this repeated structure by highlighting the subtrees associated
with any given number, in this case 96:</p>
<center>
<img class="envdia catsoop-darkmode-invert" src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/fibtree6.png" width="400">
</center>
<p>Any time we call <code>fib(96)</code> (multiple times shown here), Python will need to
explore an entire subtree to find that result, and the result will always be
the same.</p>
<p>What we'll try next is exploiting this repeated structure in the tree above by
<em>remembering</em> Fibonacci numbers as we compute them, so that we can reuse those
results later.  So, for example, when we call <code>fib(96)</code>, we'll first ask: have
I already computed this result?  If so, let's avoid repeating the work that took
and just return the result I've remembered.  Otherwise, let's do the computation
normally.  In that way, we can avoid exploring large swathes of the tree.  For
example, just remembering the result of <code>fib(96)</code> lets us cut out big parts of
the tree:</p>
<center>
<img class="envdia catsoop-darkmode-invert" src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/fibtree7.png" width="400">
</center>
<p>But then we can do the same of <code>fib(97)</code>:</p>
<center>
<img class="envdia catsoop-darkmode-invert" src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/fibtree8.png" width="400">
</center>
<p>and <code>fib(98)</code>:</p>
<center>
<img class="envdia catsoop-darkmode-invert" src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/fibtree9.png" width="400">
</center>
<p>In fact, when we cross out all subtrees that are redundant in this way, we are
left with a remaining tree that, in general for <code>fib(n)</code>, only has about <code>n</code>
nodes that aren't crossed out.  Now <em>that</em> is much more tractable to compute.</p>
<p>Here's a Python realization of the idea:</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted">cache = {}

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span>(<span class="hljs-params">n</span>):</span>
    <span class="hljs-keyword">if</span> n <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> cache:
        <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:
            cache[n] = n
        <span class="hljs-keyword">else</span>:
            cache[n] = fib(n<span class="hljs-number">-2</span>) + fib(n<span class="hljs-number">-1</span>)
    <span class="hljs-keyword">return</span> cache[n]
</code></pre></section>
<p>What's up with the word "cache"?  The English word referred originally to
something like the hiding place where a pirate stashed his treasure, but in
computer science, a <a href="https://en.wikipedia.org/wiki/Cache_(computing)">cache</a>
stores values that we think we will be consulting again soon.</p>
<p>We call the new <code>fib</code> <strong>memoized</strong>.  No, that's not a typo for "memorized."
<a href="https://en.wikipedia.org/wiki/Memoization">"Memoization"</a> is a
computer-science term for saving and reusing intermediate results, particularly
in problems with a lot of repeated structure like this one.</p>
<p>This code runs much more quickly, but it has a downside: it uses a global
variable.  All sorts of things can go wrong in larger code bases that include
global variables.  For instance, what if we wanted to use the same trick for a
factorial function?</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted">cache = {}

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">factorial</span>(<span class="hljs-params">n</span>):</span>
    <span class="hljs-keyword">if</span> n <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> cache:
        <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:
            cache[n] = <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            cache[n] = n * factorial(n<span class="hljs-number">-1</span>)
    <span class="hljs-keyword">return</span> cache[n]
</code></pre></section>
<p>Whoops, now both functions are sharing the same <code>cache</code> variable, and havoc
ensues!  (The initial assignment overwrites the existing global variable rather
than creating a new one.)  We would rather not force the authors of the two
functions to coordinate on variable-name selection.</p>
<p>Here's a version that avoids that issue by putting <code>cache</code> inside of an
enclosing frame:</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span>(<span class="hljs-params">n</span>):</span>
    cache = {}

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_actual_fib</span>(<span class="hljs-params">n</span>):</span>
        <span class="hljs-keyword">if</span> n <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> cache:
            <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:
                cache[n] = n
            <span class="hljs-keyword">else</span>:
                cache[n] = _actual_fib(n<span class="hljs-number">-2</span>) + _actual_fib(n<span class="hljs-number">-1</span>)
        <span class="hljs-keyword">return</span> cache[n]

    <span class="hljs-keyword">return</span> _actual_fib(n)
</code></pre></section>
<p>
<!--START question fib_local_cache --></p><section aria-label="Question">
<div class="question question-multiplechoice" id="cs_qdiv_fib_local_cache" style="position: static">
<div id="fib_local_cache_rendered_question">
<div id="catsoop_preamble_fib_local_cache"></div>
<div id="catsoop_prompt_fib_local_cache" style="display: inline;">How does this version behave?<br></div>
<select aria-labelledby="catsoop_prompt_fib_local_cache" id="fib_local_cache" name="fib_local_cache">
<option value="-1">--</option>
<option value="0">It gives correct answers and is about as fast as the last version.</option>
<option selected="selected" value="1">It gives correct answers and can be notably slower than the last version.</option>
<option value="2">It gives correct answers and can be notably faster than the last version.</option>
<option value="3">It contains a Python syntax error.</option>
<option value="4">It will raise an exception when it runs.</option>
<option value="5">It will return wrong answers.</option></select>
</div><div>
<span id="fib_local_cache_buttons">
<button class="submit btn btn-catsoop" id="fib_local_cache_submit" onclick="catsoop.submit('fib_local_cache');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="fib_local_cache_clearanswer" onclick="catsoop.clearanswer('fib_local_cache');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="fib_local_cache_loading_wrapper" role="status">
<span id="fib_local_cache_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="fib_local_cache_score_display" role="status"></span>
<div class="nsubmits_left" id="fib_local_cache_nsubmits_left" role="status">You have submitted this assignment 6 times.</div></div>
<div class="solution" id="fib_local_cache_solution_container">
<div id="fib_local_cache_solution">
<b>Solution:</b> It gives correct answers and can be notably slower than the last version.
</div>
<div id="fib_local_cache_solution_explanation"><hr><p><b>Explanation:</b></p>
<p>Unfortunately, each <code>cache</code> here lasts only as long as a single call to <code>fib</code>.
The old version had the cool benefit of reusing results even across top-level
calls to <code>fib</code>.  Calling the previous version twice in a row should generate an
answer instantly for the second call, regardless of the argument.</p>
<p>Here is an alternative version, which you could be excused for thinking is too clever.</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span>(<span class="hljs-params">n, cache={}</span>):</span>
    <span class="hljs-keyword">if</span> n <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> cache:
        <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:
            cache[n] = n
        <span class="hljs-keyword">else</span>:
            cache[n] = fib(n<span class="hljs-number">-2</span>) + fib(n<span class="hljs-number">-1</span>)
    <span class="hljs-keyword">return</span> cache[n]
</code></pre></section>
<p>We take advantage of the behavior of default arguments in Python, where the expression to the right of <code>argument_name=</code> is evaluated just once, at function-definition time.
Thus, so long as we don't ever pass a second argument to <code>fib</code>, we continue reusing the same cache.
Since <code>cache</code> is now a local variable, we avoid the tribulations of global variables.</p>
<p>Perhaps a more straightforward version involves using a closure like so:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_memoized_fib</span>():</span>
    cache = {}

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_real_fib</span>(<span class="hljs-params">n</span>):</span>
        <span class="hljs-keyword">if</span> n <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> cache:
            <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:
                cache[n] = n
            <span class="hljs-keyword">else</span>:
                cache[n] = fib(n<span class="hljs-number">-2</span>) + fib(n<span class="hljs-number">-1</span>)
        <span class="hljs-keyword">return</span> cache[n]

    <span class="hljs-keyword">return</span> _real_fib

fib = make_memoized_fib()
</code></pre></section>
<p>Here, in the same way, repeated calls to <code>fib</code> will share the same cache.</p>
</div>
</div>
<div aria-atomic="true" id="fib_local_cache_message" role="status"><img alt="Correct" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="></div>
</div>
</section>
<!--END question fib_local_cache -->
<p></p>
<p>OK, one major complaint handled.  However, you probably also noticed strong
similarities between the memoized Fibonacci and factorial functions.  Can we
factor the common parts out into some reusable ingredient?</p>
<p>One way to implement this would be to use a class, like so:</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MemoizedFunction</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, func</span>):</span>
        self.func = func
        self.cache = {}

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__call__</span>(<span class="hljs-params">self, *args</span>):</span>
        <span class="hljs-keyword">if</span> args <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.cache:
            self.cache[args] = self.func(*args)
        <span class="hljs-keyword">return</span> self.cache[args]
</code></pre></section>
<p>We've already seen most of the ingredients used here, though one new piece of
magic is the <code>__call__</code> method.  Whenever code tries to call some class
instance like a function, Python calls that instance's <code>__call__</code> method.  In
other words, we can define our own new function-like things by explaining what
it means to call them.</p>
<p>Another new piece of magic is the <code>*</code> syntax applied to a formal parameter, here called <code>*args</code>.
This allows the function to be called with any number of actual arguments, which are bundled up together into a <em>tuple</em> and bound to the formal parameter <code>args</code>.
(Note that there is nothing special about the name <code>args</code>.  It's just conventionally used for variable-length arguments like this, just as <code>self</code> is conventionally used for the self parameter.  And there's nothing special about using it in the <code>__call__</code> dunder method.  You can use <code>*</code> to handle variable-length arguments in any function you define.)</p>
<p>Finally, the code also uses <code>*args</code> in its body, but we've seen that before -- it's the <a href="https://py.mit.edu/spring25/readings/flood_fill#_the_unpacking_operator">unpacking operator</a>, so it unpacks the tuple back into individual arguments for the wrapped function <code>func()</code>.</p>
<p>Now we can add memoization to the original, naive Fibonacci function, like so.</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span>(<span class="hljs-params">n</span>):</span>
    <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> n
    <span class="hljs-keyword">return</span> fib(n<span class="hljs-number">-2</span>) + fib(n<span class="hljs-number">-1</span>)
fib = MemoizedFunction(fib)
</code></pre></section>
<p>But, as we saw earlier on, it turns out we don't need classes to implement
generic memoization.  Functions are more than capable, too!</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">memoize</span>(<span class="hljs-params">func</span>):</span>
    cache = {}

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_mfunc</span>(<span class="hljs-params">*args</span>):</span>
        <span class="hljs-keyword">if</span> args <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> cache:
            cache[args] = func(*args)
        <span class="hljs-keyword">return</span> cache[args]

    <span class="hljs-keyword">return</span> _mfunc
</code></pre></section>
<p>Again, naive Fibonacci is easily memoized.</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span>(<span class="hljs-params">n</span>):</span>
    <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> n
    <span class="hljs-keyword">return</span> fib(n<span class="hljs-number">-2</span>) + fib(n<span class="hljs-number">-1</span>)
fib = memoize(fib)
</code></pre></section>
<p>This pattern is so common, of using a library function to augment a function
definition, that Python has special syntax for it.  We indicate what's called a
<strong>decorator</strong> by putting an "at" sign and a function name before another
function's definition.</p>
<section aria-label="Code block"><pre><code class="language-python hljs highlighted"><span class="hljs-meta">@memoize</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span>(<span class="hljs-params">n</span>):</span>
    <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> n
    <span class="hljs-keyword">return</span> fib(n<span class="hljs-number">-2</span>) + fib(n<span class="hljs-number">-1</span>)
</code></pre></section>
<p>You may remember that we used the same trick in recitation, to instrument
functions to log all recursive calls to the screen.  Now you know that it's not
magic, and you are free to use the same trick in your own code!</p>
<script type="text/javascript">
        if (MathJax) {
            // Disable the MathJax right-click menu,
            // so that screenreader doesn't say "clickable" on every math element
            // Based on https://docs.mathjax.org/en/latest/web/configuration.html#configuring-mathjax-after-it-is-loaded
            MathJax.config.options = MathJax.config.options ?? {};
            MathJax.config.options.enableMenu = false;
            MathJax.startup.getComponents();
        }


        // give the hamburger menu icon an accessible label
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector("a.icon")?.setAttribute('aria-label', 'site-menu');
        });
        
        // based on catsoop.modal
        catsoop.vprof_survey = function (header, text, vprof_link, link_timestamp) {
          return new Promise(function (resolve, reject) {
            var response = {
            "response": null,
            "vprof_link": vprof_link,
            "link_timestamp": link_timestamp,
            "response_timestamp": null,
            "make_modal_timestamp": Date.now(),
            };
            var content = document.createElement("dialog");
            content.classList = ["catsoop-modal-content"];
            content.setAttribute("aria-labelledby", "catsoop-dialog-header");
            content.setAttribute("aria-describedby", "catsoop-dialog-body");
            content.addEventListener("keydown", function (e) {
              // this piece traps focus in the dialog while it is open
              // based on https://hidde.blog/using-javascript-to-trap-focus-in-an-element/
              if (!content.open) {
                return;
              }
              if (e.key === "Tab" || e.keyCode === 9) {
                if (e.shiftKey) {
                  if (document.activeElement === content.focusable[0]) {
                    content.focusable[content.focusable.length - 1].focus();
                    e.preventDefault();
                  }
                } else if (
                  document.activeElement ===
                  content.focusable[content.focusable.length - 1]
                ) {
                  content.focusable[0].focus();
                  e.preventDefault();
                }
              }
            });
            content.focusable = [];

            var mbody = document.createElement("div");
            mbody.classList = ["catsoop-modal-body"];

            var close_button = document.createElement("button");
            close_button.classList = ["catsoop-modal-close"];
            close_button.innerHTML = "&times;";
            close_button.setAttribute("aria-label", "Close");
            close_button.onclick = function () {
              content.close(JSON.stringify(Object.assign(response, {"response": "cancel", "response_timestamp": Date.now()})));
            };
            content.focusable.push(close_button);
            mbody.append(close_button);

            var title = document.createElement("span");
            title.id = "catsoop-dialog-header";
            title.classList = ["catsoop-modal-header"];
            title.appendChild(document.createTextNode(header));
            title.setAttribute("role", "heading");
            mbody.appendChild(title);

            var body = document.createElement("p");
            body.id = "catsoop-dialog-body";
            body.innerHTML = text + "<br/>";
            mbody.appendChild(body);

            var buttons = document.createElement("span");
            var yes_button = document.createElement("button");
            yes_button.innerText = "Yes";
            yes_button.classList = ["btn btn-catsoop"];
            yes_button.addEventListener("click", function () {
              content.close(JSON.stringify(Object.assign(response, {"response": "yes", "response_timestamp": Date.now()})));
            });
            yes_button.setAttribute("autofocus", true);
            content.focusable.push(yes_button);


            var no_button = document.createElement("button");
            no_button.innerText = "No";
            no_button.classList = ["btn btn-catsoop"];
            no_button.addEventListener("click", function () {
              content.close(JSON.stringify(Object.assign(response, {"response": "no", "response_timestamp": Date.now()})));
            });
            content.focusable.push(no_button);

            buttons.appendChild(yes_button);
            buttons.appendChild(document.createTextNode(" "));
            buttons.appendChild(no_button);
            mbody.appendChild(buttons);

            content.addEventListener("close", function () {
              content.remove();
              last_clicked_vprof_report[0] = null;
              last_clicked_vprof_report[1] = null;
              showing_vprof_survey[0] = false;
              (content.returnValue === "" ? reject : resolve)(content.returnValue);
            });

            content.appendChild(mbody);
            document.body.appendChild(content);
            content.showModal();
          });
        };


        function postVprofSurveyResponse(value){
            var data = JSON.parse(value);
            var encoded_form_pairs = [];
            for (var name in data){
                encoded_form_pairs.push(encodeURIComponent(name) + '=' + encodeURIComponent(data[name]));
            }
            //console.log("data", data)
            var form = encoded_form_pairs.join('&').replace(/%20/g, '+');
            //console.log("form data", form);

            var request = new XMLHttpRequest();
            request.onload = function(){
                var msg = request.response;
                var data = JSON.parse(msg);
                //if(data.ok){
                //    console.log("post success")
                //}else{
                //    concole.log("post error", msg, JSON.stringify(data))
                //}
            }

            request.open('POST', "https://py.mit.edu/spring25/staffonly/analytics/vprof_survey_collector", true);
            request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            request.send(form);

        }

        var showing_vprof_survey = [false];
        var last_clicked_vprof_report = [null, null];

        document.addEventListener('visibilitychange', e=>{
          if (document.visibilityState === 'visible' &&
              last_clicked_vprof_report[0] !== null &&
              !showing_vprof_survey[0]) {
              // show vorif yes/no survey
              catsoop.vprof_survey("vprof survey",
                "Did <a href='" + last_clicked_vprof_report[0] + "' target='_blank'> this vprof report</a> help you find and/or fix an efficiency bug?",
                last_clicked_vprof_report[0], last_clicked_vprof_report[1]).then(postVprofSurveyResponse, postVprofSurveyResponse);
              showing_vprof_survey[0] = true;
            }
        })

        var vprof_links  = document.getElementsByClassName("vprof_link");
        for (var i=0; i < vprof_links.length; i++) {
            let my_link = vprof_links[i].href
            if ((typeof my_link === 'string' || my_link instanceof String) && !my_link.includes("#")) {
                vprof_links[i].href = my_link + '#78111110101-50b7ffceb795e65fe8dba48b66ad8351b38526a56061272e905a62a2839c2975';
            }
            vprof_links[i].onclick = function(){
              last_clicked_vprof_report[0] = this.href;
              last_clicked_vprof_report[1] = Date.now();
            }
        }


    </script>
<script type="text/javascript">
catsoop.callbacks['submit'] = function(ok, names, status, response){
    response = JSON.parse(response);
    if (response[names[0]].score == 1){
        document.getElementById(names[0] + '_viewanswer').click();
    }
}
</script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
catsoop.all_questions = ['all_caps_list', 'repeat_n_times', 'counter', 'fib_num_94', 'fib_local_cache'];
catsoop.username = 'tjampa';
catsoop.this_path = 'https://py.mit.edu/spring25/readings/functional_programming';
catsoop.path_info = ['spring25', 'readings', 'functional_programming'];
catsoop.course = 'spring25';
catsoop.url_root = 'https://py.mit.edu';
catsoop.imp = '';
catsoop.skip_alert = ["all_caps_list", "repeat_n_times", "counter", "fib_num_94", "fib_local_cache"];
catsoop.viewans_confirm = "Are you sure?  Viewing the answer will prevent any further submissions to this question.  Press 'OK' to view the answer, or press 'Cancel' if you have changed your mind.";

// @license-end</script>
<div id="cs_footnotes" style="display:none;"></div>
</div>
</div>
<div class="cs_right_menu"></div>
</div>
<footer>
<nav aria-label="Breadcrumbs" class="cs_navigation cs_bottom_navigation" id="cs_bottom_navigation"><li><a href="https://py.mit.edu/spring25">Home</a></li><li><a href="https://py.mit.edu/spring25/readings">Course Readings</a></li><li><a href="https://py.mit.edu/spring25/readings/functional_programming">Functional Programming</a></li></nav>
<div class="cs_footer">
      This page was last updated on Saturday April 26, 2025 at 09:52:01 PM (revision <code>9aaf0d69</code>).<br>&nbsp;<br>
<center><img src="Functional%20Programming%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/cc-by-sa.svg" style="width: 2cm;"></center><div style="max-width: 600px; margin-bottom:1em; margin-left:auto; margin-right:auto;">Except where otherwise noted, these readings are licensed under a<br><a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" target="_blank">Creative Commons&nbsp;BY-SA&nbsp;4.0</a> license.  Portions of the readings were derived from<br>or inspired by the <a href="https://web.mit.edu/6.031/www/sp25/" target="_blank">6.031 Course Notes</a>, the <a href="https://hz.mit.edu/catsoop/6.145" target="_blank">6.145 Course Notes</a>, and the 6.01 Course Notes.
</div>
<pre class="catsooplogo" style="font-size:50%;">\            
/    /\__/\  
\__=(  o_O )=
(__________) 
 |_ |_ |_ |_ </pre>
      Powered by <a href="https://catsoop.org/" target="_blank">CAT-SOOP</a> v19.0.6+hg.14.f36ce1d1 "Korat" (LTS) (development snapshot).<br>
      CAT-SOOP is <a href="https://www.fsf.org/about/what-is-free-software" target="_blank">Free/Libre Software</a>, available under the terms<br>of the <a href="https://py.mit.edu/_util/license" target="_blank">GNU Affero General Public License, version 3</a>.<br>
<a download="" href="https://py.mit.edu/_util/source.zip" target="_blank">Download Source Code</a><br>
<a href="https://py.mit.edu/_util/jslicense.html" rel="jslicense" target="_blank">Javascript License Information</a>
</div>
</footer>



</body></html>