<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<!-- This page was generated by CAT-SOOP 19.0.6+hg.14.f36ce1d1.  miau. -->
<meta charset="utf-8">
<title>Efficiency | Course Readings | 6.101 Spring 2025</title>
<link href="Efficiency%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/logo.gif" rel="icon" type="image/gif">
<!-- include catsoop base css -->
<link href="Efficiency%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/base.css" rel="stylesheet" type="text/css">
<!-- set up JS namespace for catsoop -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    var catsoop = {plugins: {}};

    function toggleResponsiveHeader(){
        document.getElementsByTagName('header')[0].classList.toggle('responsive');
    }

    function toggleAttribute(elt, attr){
        elt.setAttribute(attr, elt.getAttribute(attr) === "true" ? "false" : "true");
    }

    catsoop.topMenuFocus = function(event) {
        var elt = event.target;
        var target = event.relatedTarget;
        if (elt.classList.contains('menu-submenu')){
            var topmenu = elt.parentNode.parentNode;
            if (target && !target.classList.contains("menu-submenu") && target !== topmenu.children[1]) {
                clearMenu(topmenu);
            }
        }else if (!target.classList.contains('cs_top_menu_item')){
            clearMenu(elt.parentNode);
        }
    }

    window.addEventListener('DOMContentLoaded', function(){
        var menu_boxes = document.getElementsByClassName('dropdown-checkbox');
        for(var i=0; i<menu_boxes.length; i++){
            menu_boxes[i].checked = false;
        }
    });

    function clearMenu(menu){
       menu.children[1].checked = false;
    }
    // @license-end
    </script>
<!-- dark mode -->
<script src="Efficiency%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/darkreader.min.js" type="text/javascript"></script>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.dark_mode_settings = null;
    if (catsoop.dark_mode_settings === null){
        catsoop.dark_mode_settings = JSON.parse(localStorage.getItem('catsoop_dark_mode_settings'));
        if (catsoop.dark_mode_settings === null){
            catsoop.dark_mode_settings = {'mode': 'disabled', 'brightness': 100, 'contrast': 90, 'sepia': 10, 'grayscale': 0};
        }
    }
    localStorage.setItem('catsoop_dark_mode_settings', JSON.stringify(catsoop.dark_mode_settings));
    catsoop.dark_mode = catsoop.dark_mode_settings.mode;
    delete catsoop.dark_mode_settings.mode;
    if (catsoop.dark_mode === 'enabled' || catsoop.dark_mode === 'auto'){
        DarkReader[catsoop.dark_mode == 'enabled' ? 'enable' : 'auto'](catsoop.dark_mode_settings);
    }
    
    document.addEventListener("DOMContentLoaded", function(event) {
        if (DarkReader.isEnabled()) {
            var invertfilter = 'invert(100%) hue-rotate(180deg)' +
                               ' brightness(' + catsoop.dark_mode_settings.brightness + '%)' +
                               ' contrast(' + catsoop.dark_mode_settings.contrast + '%)' +
                               ' grayscale(' + catsoop.dark_mode_settings.grayscale + '%)' +
                               ' sepia(' + catsoop.dark_mode_settings.sepia + '%)'
            var inverter = document.createElement('style');
            inverter.innerText = 'img.catsoop-darkmode-invert, video.catsoop-darkmode-invert {filter: ' + invertfilter + ';}\n\n'
            document.head.appendChild(inverter);
        }
    });
    // @license-end
    </script>
<!-- load in mathjax and CAT-SOOP-specific math rendering  -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    MathJax = {
      startup: {
        typeset: false,
      }
    }

    catsoop.render_math = function (elt) {
        if(elt.classList.contains('cs_displaymath')){
            var b = "\\[";
            var e = "\\]";
        }else{
            var b = "\\(";
            var e = "\\)";
        }
        elt.innerText = b + elt.innerText + e;
        MathJax.typeset([elt]);
        elt.classList.remove('cs_math_to_render');
    }


    catsoop.render_all_math = function (elt){
        if (elt === null) {
            return;
        }
        var mathelts = elt.getElementsByClassName('cs_math_to_render');
        while(mathelts.length > 0){
            catsoop.render_math(mathelts[0]);
        }
    }
    document.addEventListener("DOMContentLoaded", function(event) {
          catsoop.render_all_math(document);
    });
    // @license-end
    </script>
<script id="MathJax-script" src="Efficiency%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/tex-chtml-full-speech.js"></script><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style>
<!-- load in diagram stuff -->
<script src="Efficiency%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/cs_diagrams.js" type="text/javascript"></script>
<script type="text/javascript">
        catsoop.diagram_sources = {};
    </script>
<!-- Syntax Highlighting -->
<script src="Efficiency%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/highlight.min.js" type="text/javascript"></script>
<script src="Efficiency%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/highlightjs-line-numbers.js" type="text/javascript"></script><style type="text/css">.hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}</style>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.syntax_highlighting = function (elt) {
        if (elt === null) {
            return;
        }
        elt.querySelectorAll('pre > code:not(.highlighted)').forEach((block) => {
            hljs.highlightBlock(block);
            var wrap = document.createElement("section");
            wrap.setAttribute("aria-label", "Code block");
            block.parentNode.replaceWith(wrap);
            wrap.append(block.parentNode);
            block.classList.add('highlighted');
        });
        elt.querySelectorAll('code.highlight-lines').forEach(function(b){
            hljs.lineNumbersBlock(b);
            if ((b.innerHTML.trim().match(/\r\n|\r|\n/g) || []).length > 0){
                b.parentElement.style = "padding-left: 0px !important;"
                b.classList.add('hljs');
            }
            b.classList.remove('highlight-lines');
        });
    }
    window.addEventListener('DOMContentLoaded', function(){
        catsoop.syntax_highlighting(document);
    });
    // @license-end
    </script>
<style>
      :root {
        --cs-base-bg-color: #0350ba;
        --cs-light-bg-color: #629ced;
        --cs-base-font-color: #fff;
        --cs-light-font-color: #000;
    }
    </style>
<style>
.cs_top_menu_item {
  font-size: 0.88rem;
}
div.dropdown {
  -moz-transform: translateY(-1px);
}
img {
  max-width:100% !important;
}
.visually-hidden {
	position: absolute !important;
	width: 1px !important;
	height: 1px !important;
	padding: 0 !important;
	margin: -1px !important;
	overflow: hidden !important;
	clip: rect(0,0,0,0) !important;
	white-space: nowrap !important;
	border: 0 !important;
}
kbd {
  background-color: #eee;
  border-radius: 3px;
  border: 1px solid #b4b4b4;
  box-shadow:
    0 1px 1px rgba(0, 0, 0, 0.2),
    0 2px 0 0 rgba(255, 255, 255, 0.7) inset;
  color: #333;
  display: inline-block;
  font-size: 0.85em;
  font-weight: 700;
  line-height: 1;
  padding: 2px 4px;
  white-space: nowrap;
}
</style>
<style>
[id^=cs_qdiv].question-lab101 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101 [id$=nsubmits_left] {
  display: none;
}

[id^=cs_qdiv].question-lab101_vprof [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101_vprof [id$=nsubmits_left] {
  display: none;
}

</style>
<script>
MathJax.options.enableMenu = false;
</script>
<style>
h2.cs_section_title {
   margin-top: 3em;
}
h3.cs_section_title {
   margin-top: 3em;
}
h4.cs_section_title {
   margin-top: 2em;
}
code.hljs {
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
img.envdia {
  border-radius: 5px;
  border: 2px #ccc solid;
}
img.pixels {
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges;
  image-rendering: crisp-edges;
}
button[id$=clearanswer] {
  display: none;
}
.flex { display: flex; flex-wrap: wrap; }
.flex > pre { flex: 1; }
.flex > img { flex: 0 1; }
</style>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function (){
    document.querySelectorAll("img.envdia").forEach(function (b){
        b.classList.add("catsoop-darkmode-invert")
    });
});
</script>
<script src="Efficiency%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/multistep.js" type="text/javascript"></script>
<link href="Efficiency%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/multistep.css" rel="stylesheet">
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
document.addEventListener("DOMContentLoaded", function(){
    sessionStorage.setItem("last-non-settings", catsoop.this_path);
});
// @license-end
</script>
<script src="Efficiency%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/cs_ajax.js" type="text/javascript"></script>
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
</head>
<body style="margin: 0px;">
<header id="cs_header">
<div aria-role="menubar" class="nav-container">
<div class="cs_header_text"><a href="https://py.mit.edu/spring25"><img src="Efficiency%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/logo.gif">&nbsp;6.101</a></div>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_c1a43e3f699a1ed71997b0321c2e9ffd">Information<span aria-hidden="true" class="downarrow">▼</span></label>
<input class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_c1a43e3f699a1ed71997b0321c2e9ffd" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox">
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/basics" onblur="catsoop.topMenuFocus(event);" role="menuitem">Basics and Schedule</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/grading" onblur="catsoop.topMenuFocus(event);" role="menuitem">Grading Policies</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/academic_integrity" onblur="catsoop.topMenuFocus(event);" role="menuitem">Academic Integrity</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/help" onblur="catsoop.topMenuFocus(event);" role="menuitem">Getting Help</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/infrastructure" onblur="catsoop.topMenuFocus(event);" role="menuitem">Infrastructure</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/staff" onblur="catsoop.topMenuFocus(event);" role="menuitem">Staff List</a></div></div>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_ee51a2d5002bd02613936bd9b2f3dbee">Materials<span aria-hidden="true" class="downarrow">▼</span></label>
<input class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_ee51a2d5002bd02613936bd9b2f3dbee" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox">
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/calendar" onblur="catsoop.topMenuFocus(event);" role="menuitem">Calendar</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/readings" onblur="catsoop.topMenuFocus(event);" role="menuitem">Readings</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/labs" onblur="catsoop.topMenuFocus(event);" role="menuitem">Labs</a></div></div>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring25/progress" onblur="catsoop.topMenuFocus(event);" role="menuitem">Progress</a>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring25/queue" onblur="catsoop.topMenuFocus(event);" role="menuitem">Queue</a>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_0323be52022747c10863df67ee9ad8bf">tjampa<span aria-hidden="true" class="downarrow">▼</span></label>
<input class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_0323be52022747c10863df67ee9ad8bf" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox">
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/ssh_keys" onblur="catsoop.topMenuFocus(event);" role="menuitem">Manage SSH Keys</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/_util/user_settings" onblur="catsoop.topMenuFocus(event);" role="menuitem">Settings</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/readings/efficiency?loginaction=logout" onblur="catsoop.topMenuFocus(event);" role="menuitem">Log Out</a></div></div><a class="icon" href="javascript:void(0);" onclick="toggleResponsiveHeader()" aria-label="site-menu">☰</a>
</div>
</header>
<nav aria-label="Breadcrumbs" class="cs_navigation cs_top_navigation" id="cs_breadcrumbs"><li><a href="https://py.mit.edu/spring25">Home</a></li><li><a href="https://py.mit.edu/spring25/readings">Course Readings</a></li><li><a href="https://py.mit.edu/spring25/readings/efficiency">Efficiency</a></li></nav>
<div class="cs_body" id="cs_body">
<div class="cs_left_menu"></div>
<div class="cs_content">
<div class="cs_page_body" role="main">
<center><h1 class="cs_content_header">Efficiency</h1></center>
<h2 aria-hidden="true">Table of Contents</h2><ul aria-label="Table of Contents" role="navigation"><li><a href="#_introduction">1) Introduction</a></li><li><a href="#_categorizing_efficiency_bugs">2) Categorizing Efficiency Bugs</a></li><ul><li><a href="#_superfluous_computation">2.1) Superfluous Computation</a></li><ul><li><a href="#_failing_to_cache">2.1.1) Failing to Cache</a></li><li><a href="#_failing_to_short_circuit">2.1.2) Failing to Short Circuit</a></li><li><a href="#_executing_dead_code">2.1.3) Executing Dead Code</a></li><li><a href="#_extra_copying">2.1.4) Extra Copying</a></li><li><a href="#_failing_to_hoist">2.1.5) Failing to Hoist</a></li><li><a href="#_extra_loop_recursive_overhead">2.1.6) Extra Loop / Recursive Overhead</a></li></ul><li><a href="#_suboptimal_data_structure_design">2.2) Suboptimal Data Structure Design</a></li><ul><li><a href="#_slow_data_structure">2.2.1) Slow Data Structure</a></li><li><a href="#_expensive_data_transformation">2.2.2) Expensive Data Transformation</a></li></ul><li><a href="#_suboptimal_algorithm_design">2.3) Suboptimal Algorithm Design</a></li><ul><li><a href="#_solving_irrelevant_subproblems">2.3.1) Solving Irrelevant Subproblems</a></li><li><a href="#_misordering_subproblems">2.3.2) Misordering Subproblems</a></li><li><a href="#_repeatedly_solving_subproblems">2.3.3) Repeatedly Solving Subproblems</a></li><li><a href="#_reimplementing_builtins">2.3.4) Reimplementing Builtins</a></li></ul></ul><li><a href="#_finding_and_fixing_efficiency_bugs">3)  Finding and Fixing Efficiency Bugs </a></li><ul><li><a href="#_time_your_code">3.1)  Time your code </a></li><li><a href="#_make_a_list_of_potential_slow_functions">3.2)  Make a list of potential slow functions </a></li><li><a href="#_make_a_list_of_efficiency_bug_hypotheses">3.3)  Make a list of efficiency bug hypotheses </a></li><li><a href="#_select_your_best_hypothesis_and_implement_the_fix">3.4)  Select your best hypothesis and implement the fix </a></li><li><a href="#_time_your_code_again_and_note_the_difference">3.5)  Time your code again (and note the difference) </a></li></ul><li><a href="#_conclusion">4)  Conclusion </a></li></ul>
<p><a class="anchor" name="catsoop_section_1"></a><a class="anchor" name="_introduction"></a></p><h2 class="cs_section_title">1) Introduction<a class="cs_permalink" href="#_introduction">§</a></h2><p></p>
<p>What makes for a good program? One of the first things that people may think of
is program correctness. In most programming courses, style and readability are
also emphasized. Correct and readable programs are not very useful, however, if
they do not run in a reasonable amount of time. This is where program efficiency
comes into play.</p>
<p>Print-statement debugging and thoughtful test cases can help programmers fix
correctness issues, and tools like <a href="https://pypi.org/project/pylint/">Pylint</a> and
<a href="https://pypi.org/project/black/"><em>Black</em></a> can find and fix many style
issues. <strong>Efficiency bugs</strong>, which are pieces of code that 
lead to extra work or
memory which slow a program down without affecting correctness, can be 
more
difficult to pinpoint. In 6.101, efficiency bugs often show up as a 
timed-out test
case on the submission server, but may also appear as a program that 
takes a long time to run on your own machine -- or even never stops 
running!</p>
<p>Efficiency bugs may be difficult to locate, but learning about common efficiency
bugs is a good first step towards finding and fixing them. And, just like
program correctness bugs and style issues, efficiency bugs become easier to find
and fix with practice.</p>
<p><a class="anchor" name="catsoop_section_2"></a><a class="anchor" name="_categorizing_efficiency_bugs"></a></p><h2 class="cs_section_title">2) Categorizing Efficiency Bugs<a class="cs_permalink" href="#_categorizing_efficiency_bugs">§</a></h2><p></p>
<p>What constitutes an efficiency bug is often dependent on the characteristics of
the current problem. For example, many small problems do not require a highly
optimized solution; it is fine to sort through a small list of numbers with
a slow selection sort, as long as the list will always be small.
Efficiency becomes more important as the size or frequency
of the problem increases. The efficiency of sorting algorithms used by search
engines has important implications for global energy usage, for example.</p>
<p>When approaching a new problem, it can be helpful to focus initially on
correctness for small, simple cases first, because these programs are usually
easier to implement and debug. It takes time and effort to optimize a program,
so it's best to start with a simple, working version, and then optimize it to
make it more efficient as needed.</p>
<p>The root causes of efficiency bugs are often similar across problems.
 For the purposes of 6.101, this reading focuses on time-related 
efficiency bugs,
across three general categories:</p>
<ul>
<li><strong>Superfluous Computation</strong>:
Code that can be deleted, or computation that can be repeated fewer times,
without affecting correct functionality.</li>
<li><strong>Suboptimal Data Structure Design</strong>:
Creating or using a data structure that has slow operations, when a more
efficient data structure exists.</li>
<li><strong>Suboptimal Algorithm Design</strong>:
Not taking advantage of problem characteristics
that would enable a significantly more efficient algorithm.</li>
</ul>
<p><a class="anchor" name="catsoop_section_2_1"></a><a class="anchor" name="_superfluous_computation"></a></p><h3 class="cs_section_title">2.1) Superfluous Computation<a class="cs_permalink" href="#_superfluous_computation">§</a></h3><p></p>
<p>Superfluous computations can be fixed with small modifications to code that
eliminate unnecessary or duplicate
computation. The 6.101 course staff have noticed that the first two bugs in this category — failing to cache and failing to
short circuit — are the most common efficiency bugs in student code.</p>
<p><a class="anchor" name="catsoop_section_2_1_1"></a><a class="anchor" name="_failing_to_cache"></a></p><h4 class="cs_section_title">2.1.1) Failing to Cache<a class="cs_permalink" href="#_failing_to_cache">§</a></h4><p></p>
<ul>
<li><strong>Definition</strong>:
Not storing or not using data, resulting in repeated computation.</li>
</ul>
<p>The term <em>caching</em> means temporarily storing a data value that was expensive to obtain,
with the expectation of reusing it later in a program. In the code below, the result of calling <code>slow_call</code> on
<code>y</code> is cached in the variable <code>y_result</code>. Notice, however, that the cached value
stored in <code>y_result</code> is never used -- instead, <code>slow_call(y)</code> is just called repeatedly.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">y_result = slow_call(y)
<span class="hljs-keyword">if</span> slow_call(x) &lt; <span class="hljs-number">0</span>:
    foo(slow_call(x), slow_call(y))
<span class="hljs-keyword">else</span>:
    bar(slow_call(x), slow_call(y))
</code></pre></section>
<p>The following code is an improvement, using the cached value stored in <code>y_result</code>
rather than recalculating <code>slow_call(y)</code>. However, there still remains a failure
to cache in the code below.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">y_result = slow_call(y)
<span class="hljs-keyword">if</span> slow_call(x) &lt; <span class="hljs-number">0</span>:
    foo(slow_call(x), y_result)
<span class="hljs-keyword">else</span>:
    bar(slow_call(x), y_result)
</code></pre></section>
<p>The following code caches the result of <code>slow_call(x)</code> in the variable <code>x_result</code>,
eliminating the redundant calls to <code>slow_call(x)</code>.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">y_result = slow_call(y)
x_result = slow_call(x)
<span class="hljs-keyword">if</span> x_result &lt; <span class="hljs-number">0</span>:
    foo(x_result, y_result)
<span class="hljs-keyword">else</span>:
    bar(x_result, y_result)
</code></pre></section>
<p>Keep an eye out for ways to avoid calling functions repeatedly with the same inputs in
your own code!</p>
<p><a class="anchor" name="catsoop_section_2_1_2"></a><a class="anchor" name="_failing_to_short_circuit"></a></p><h4 class="cs_section_title">2.1.2) Failing to Short Circuit<a class="cs_permalink" href="#_failing_to_short_circuit">§</a></h4><p></p>
<ul>
<li><strong>Definition</strong>:
Continuing a computation after the answer has already been determined,
or ordering computation in a way that prevents exiting sooner, when it is possible to exit sooner.</li>
</ul>
<p>The following function determines if a given list of words from a book has any
spelling errors.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">book_has_error</span>(<span class="hljs-params">book_words</span>):</span>
    has_error = <span class="hljs-literal">False</span>
    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> book_words:
        <span class="hljs-keyword">if</span> spelling_error(word):
            has_error = <span class="hljs-literal">True</span>
    <span class="hljs-keyword">return</span> has_error
</code></pre></section>
<p>If there is an error in a word early in the book, this
function will still keep running until the end of the book, long after the return value of the
function has been determined.  This is a failure to short circuit. One
way to fix the code could be to add a <code>break</code> statement after the
return value is determined, to prevent the continued execution of the loop.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">book_has_error</span>(<span class="hljs-params">book_words</span>):</span>
    has_error = <span class="hljs-literal">False</span>
    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> book_words:
        <span class="hljs-keyword">if</span> spelling_error(word):
            has_error = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">return</span> has_error
</code></pre></section>
<p>Another way to fix the efficiency bug is by returning as soon as
<code>spelling_error(word)</code> evaluates to <code>True</code>.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">book_has_error</span>(<span class="hljs-params">book_words</span>):</span>
    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> book_words:
        <span class="hljs-keyword">if</span> spelling_error(word):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre></section>
<p>&nbsp;</p>
<p>The term <em>short circuiting</em> is also used in programming to refer to the
short-circuit evaluation of conditional expressions. The Python interpreter
stops evaluating boolean expressions as soon as it determines the value
of the expression.</p>
<div class="question"><b>Check Yourself:</b><p></p><p>What happens when you execute the following block of code?</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (<span class="hljs-number">1</span> == <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> (<span class="hljs-string">"5"</span> + <span class="hljs-number">5</span>) == <span class="hljs-number">10</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"I am printed"</span>)
</code></pre></section>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div><br>
This program outputs:
<p><code>I am printed</code></p>
<p>This may be surprising because evaluating <code>"5" + 5</code> would normally cause a
<code>TypeError</code>. However, because <code>1 == 2</code> evaluates to <code>False</code>, and
<code>False and something_else</code> will always evaluate to <code>False</code>, the Python
interpreter short-circuits and does not evaluate the rest of the
conditional statement. Because <code>"5" + 5</code> is never executed, the <code>TypeError</code>
never occurs!</p>
</div></div>
<p></p><p><span id="queue_checkyourself_1"></span></p></div>
<p>&nbsp;</p>
<div class="question"><b>Check Yourself:</b><p></p><p>Ordering the boolean-valued functions in a boolean expression strategically
can often lead to program speedups. Which of the following code blocks do you think will
generally run faster on random integer inputs?</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">even_with_n_prime_factors</span>(<span class="hljs-params">x, n</span>):</span>
    <span class="hljs-keyword">return</span> len(get_prime_factors(x)) == n <span class="hljs-keyword">and</span> x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>
</code></pre></section>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">even_with_n_prime_factors</span>(<span class="hljs-params">x, n</span>):</span>
    <span class="hljs-keyword">return</span> x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> len(get_prime_factors(x)) == n
</code></pre></section>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>The second code block will generally perform better on a random integer.
A random integer is odd about half the time, and in those cases,
the slower <code>get_prime_factors</code> function will not be called. In contrast,
the first implementation will call <code>get_prime_factors</code> on every integer.</div></div>
<p></p><p><span id="queue_checkyourself_2"></span></p></div>
<p><a class="anchor" name="catsoop_section_2_1_3"></a><a class="anchor" name="_executing_dead_code"></a></p><h4 class="cs_section_title">2.1.3) Executing Dead Code<a class="cs_permalink" href="#_executing_dead_code">§</a></h4><p></p>
<ul>
<li><strong>Definition</strong>:
Including code that can be removed with very slight changes, when removing the
code would increase efficiency without modifying correct functionality.</li>
</ul>
<p>Strategically placed print statements are a great debugging tool.
However, when print statements are left in debugged code, they can
cause significant code slowdown.</p>
<div class="question"><b>Check Yourself:</b><p></p><p>How much more time do you think it will take to run the second code
block than the first?</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">total = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>_000_000):
    total += i
</code></pre></section>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">total = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>_000_000):
    total += i
    <span class="hljs-built_in">print</span>(i, total)
</code></pre></section>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>Using the Python time module, we can find out!
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-keyword">import</span> time
start_time = time.time()

total = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>_000_000):
    total += i

end_time = time.time()
total_time = end_time - start_time
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{total_time=}</span>"</span>)
</code></pre></section>
<p>Running the following code produces the output <code>total_time=0.09513139724731445</code>,
which means it ran in under .1 seconds.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">start_time = time.time()

total = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>_000_000):
    total += i
    <span class="hljs-built_in">print</span>(i, total)

end_time = time.time()
total_time = end_time - start_time
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{total_time=}</span>"</span>)
</code></pre></section>
<p>This code, however, prints out <code>total_time=90.36704635620117</code>.
While the <code>total_time</code> you get on your computer may differ, it is safe to say
that adding the print statement makes the code well over a hundred times slower!</p></div></div>
<p></p><p><span id="queue_checkyourself_3"></span></p></div>
<p>Not all instances of dead code are as straightforward to find as stray
print statements. For example, if you look closely at the <code>get_nested_items</code>
function below you will notice that the inner <code>helper</code> function does
a lot of duplicate work.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_nested_items</span>(<span class="hljs-params">nested_list</span>):</span>
    <span class="hljs-string">"""
    Given a nested list of numbers, return a set of all the numbers that it contains.

    input: [1, 2, [3, 4, [5, 6, 7]], 8, [9, 10]]
    output: {1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
    """</span>
    items = set()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">helper</span>(<span class="hljs-params">nested_list</span>):</span>
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> nested_list:
            <span class="hljs-keyword">if</span> isinstance(item, list):
	        <span class="hljs-comment"># Recurse on sublist</span>
                helper(item)

		<span class="hljs-comment"># Add items of sublist</span>
                <span class="hljs-keyword">for</span> sub_item <span class="hljs-keyword">in</span> item:
                    <span class="hljs-keyword">if</span> isinstance(sub_item, list):
                        helper(sub_item)
                    <span class="hljs-keyword">else</span>:
                        items.add(sub_item)
            <span class="hljs-keyword">else</span>:
                items.add(item)

    helper(nested_list)
    <span class="hljs-keyword">return</span>(items)
</code></pre></section>
<p>The second version of the function, shown below, produces an identical result:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_nested_items</span>(<span class="hljs-params">nested_list</span>):</span>
    <span class="hljs-string">"""
    Given a nested list of numbers, return a set of all the numbers that it contains.

    input: [1, 2, [3, 4, [5, 6, 7]], 8, [9, 10]]
    output: {1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
    """</span>
    items = set()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">helper</span>(<span class="hljs-params">nested_list</span>):</span>
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> nested_list:
            <span class="hljs-keyword">if</span> isinstance(item, list):
	    	<span class="hljs-comment"># Recurse on sublist.</span>
		<span class="hljs-comment"># After this, there's no need to iterate!</span>
                helper(item)
            <span class="hljs-keyword">else</span>:
                items.add(item)

    helper(nested_list)
    <span class="hljs-keyword">return</span>(items)
</code></pre></section>
<div class="question"><b>Check Yourself:</b><p></p><p>How much extra work does the first version of <code>get_nested_items</code> perform?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div><br>
<p>Changing <code>items</code> from a <code>set</code> to a <code>list</code> makes it clear how much extra
work the initial code does.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_nested_items</span>(<span class="hljs-params">nested_list</span>):</span>
    <span class="hljs-string">"""
    input: [1, 2, [3, 4, [5, 6, 7]], 8, [9, 10]]
    (expected) output: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    """</span>
    items = []

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">helper</span>(<span class="hljs-params">nested_list</span>):</span>
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> nested_list:
            <span class="hljs-keyword">if</span> isinstance(item, list):
                helper(item)
                <span class="hljs-keyword">for</span> sub_item <span class="hljs-keyword">in</span> item:
                    <span class="hljs-keyword">if</span> isinstance(sub_item, list):
                        helper(sub_item)
                    <span class="hljs-keyword">else</span>:
                        items.append(sub_item)
            <span class="hljs-keyword">else</span>:
                items.append(item)

    helper(nested_list)
    <span class="hljs-keyword">return</span>(items)

input = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]], <span class="hljs-number">8</span>, [<span class="hljs-number">9</span>, <span class="hljs-number">10</span>]]
<span class="hljs-built_in">print</span>(get_nested_items(input))
</code></pre></section>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_nested_items</span>(<span class="hljs-params">nested_list</span>):</span>
    <span class="hljs-string">"""
    input: [1, 2, [3, 4, [5, 6, 7]], 8, [9, 10]]
    output: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    """</span>
    items = []

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">helper</span>(<span class="hljs-params">nested_list</span>):</span>
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> nested_list:
            <span class="hljs-keyword">if</span> isinstance(item, list):
                helper(item)
            <span class="hljs-keyword">else</span>:
                items.append(item)

    helper(nested_list)
    <span class="hljs-keyword">return</span>(items)

input = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]], <span class="hljs-number">8</span>, [<span class="hljs-number">9</span>, <span class="hljs-number">10</span>]]
<span class="hljs-built_in">print</span>(get_nested_items(input))
</code></pre></section>
<p>The first code block outputs
<code>[1, 2, 3, 4, 5, 6, 7, 5, 6, 7, 3, 4, 5, 6, 7, 8, 9, 10, 9, 10]</code> whereas the
second version outputs <code>[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</code>, as desired.</p>
</div></div>
<p></p><p><span id="queue_checkyourself_4"></span></p></div>
<p>It is often tempting when writing a recursive function to include
an extra layer of explicit computation beyond the necessary base cases and
recursive cases, but this can lead to the creation of dead code.</p>
<p><a class="anchor" name="catsoop_section_2_1_4"></a><a class="anchor" name="_extra_copying"></a></p><h4 class="cs_section_title">2.1.4) Extra Copying<a class="cs_permalink" href="#_extra_copying">§</a></h4><p></p>
<ul>
<li><strong>Definition</strong>:
Creating shallow or deep copies of data that either will not be modified,
or that could safely be modified without copying.</li>
</ul>
<p>Unexpected modification of a mutable object (called an <em>aliasing bug</em>) is a common source of correctness bugs.
For example,
in the following function, modifying a list while iterating through it results
in an infinite loop:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">duplicate_even_elts</span>(<span class="hljs-params">my_list</span>):</span>
    <span class="hljs-string">"""
    Modify my_list to create adjacent duplicates of even numbers.
    input: [1, 2, 3, 4, 5, 6]
    (expected) output: [1, 2, 2, 3, 4, 4, 5, 6, 6]
    """</span>
    index = <span class="hljs-number">0</span>

    <span class="hljs-keyword">for</span> elt <span class="hljs-keyword">in</span> my_list:
        <span class="hljs-keyword">if</span> elt % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:
            my_list.insert(index, elt)
            index += <span class="hljs-number">2</span>
        <span class="hljs-keyword">else</span>:
            index += <span class="hljs-number">1</span>

    <span class="hljs-keyword">return</span> my_list
</code></pre></section>
<p>This issue can be quickly fixed by making a copy of <code>my_list</code> to iterate
through, as shown in the code block below (which produces the correct output):</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">duplicate_even_elts</span>(<span class="hljs-params">my_list</span>):</span>
    <span class="hljs-string">"""
    Modify my_list to create adjacent duplicates of even numbers.
    input: [1, 2, 3, 4, 5, 6]
    output: [1, 2, 2, 3, 4, 4, 5, 6, 6]
    """</span>
    index = <span class="hljs-number">0</span>

    <span class="hljs-keyword">for</span> elt <span class="hljs-keyword">in</span> my_list.copy():
        <span class="hljs-keyword">if</span> elt % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:
            my_list.insert(index, elt)
            index += <span class="hljs-number">2</span>
        <span class="hljs-keyword">else</span>:
            index += <span class="hljs-number">1</span>

    <span class="hljs-keyword">return</span> my_list
</code></pre></section>
<div class="question"><b>Check Yourself:</b><p></p><p>How can you fix <code>duplicate_even_elts</code> without creating a copy of <code>my_list</code>?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div><p>This is one example where a while loop is useful!</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">duplicate_even_elts</span>(<span class="hljs-params">my_list</span>):</span>
    <span class="hljs-string">"""
    Modify my_list to create adjacent duplicates of even numbers.
    input: [1, 2, 3, 4, 5, 6]
    output: [1, 2, 2, 3, 4, 4, 5, 6, 6]
    """</span>
    index = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> index &lt; len(my_list):
        elt = my_list[index]
        <span class="hljs-keyword">if</span> elt % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:
            my_list.insert(index, elt)
            index += <span class="hljs-number">2</span>
        <span class="hljs-keyword">else</span>:
            index += <span class="hljs-number">1</span>

    <span class="hljs-keyword">return</span> my_list
</code></pre></section>
</div></div>
<p></p><p><span id="queue_checkyourself_5"></span></p></div>
<p>Due to the common occurrence of aliasing bugs, many programmers
have a tendency to create copies of data structures, even when there
is no risk of aliasing bugs. In the case below, the programmer creates
a copy before iterating over it, which results in unnecessary computation:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">list_special_sum</span>(<span class="hljs-params">my_list</span>):</span>
    <span class="hljs-string">"""
    Sums list values, doubling the values of even elements

    input: [1, 2, 3, 4, 5, 6]
    output: 33
    """</span>
    total = <span class="hljs-number">0</span>

    <span class="hljs-keyword">for</span> elt <span class="hljs-keyword">in</span> my_list.copy(): <span class="hljs-comment"># unnecessary copy -- we can use my_list without copying</span>
        <span class="hljs-keyword">if</span> elt % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:
            total += <span class="hljs-number">2</span> * elt
        <span class="hljs-keyword">else</span>:
            total += elt

    <span class="hljs-keyword">return</span> total
</code></pre></section>
<div class="question"><b>Check Yourself:</b><p></p><p>Other instances of extra copying are less explicit. Can you spot the
extra copying in the code below?</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_full_names</span>(<span class="hljs-params">name_tuples</span>):</span>
    <span class="hljs-string">"""
    name_tuples is a list of tuples in the form of
    [("Kevin", "Bacon"), ("Tim, "Beaver"), ...]

    Returns a list of strings in the form of ["Kevin Bacon", "Tim Beaver", ... ]
    """</span>
    full_names = []

    <span class="hljs-keyword">for</span> first, last <span class="hljs-keyword">in</span> name_tuples:
        full_names = full_names + [str(first) + <span class="hljs-string">" "</span> + str(last)]

    <span class="hljs-keyword">return</span> full_names
</code></pre></section>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div><br>
<p>In this case, <code>first</code> and <code>last</code> are already of type <code>str</code>, so calling <code>str()</code>
results in the creation of extra copies of <code>first</code> and <code>last</code>. This extra-copying
bug is fixed in the following code:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_full_names</span>(<span class="hljs-params">name_tuples</span>):</span>
    <span class="hljs-string">"""
    name_tuples is a list of tuples in the form of
    [("Kevin", "Bacon"), ("Tim, "Beaver"), ...]

    Returns a list of strings in the form of ["Kevin Bacon", "Tim Beaver", ... ]
    """</span>
    full_names = []

    <span class="hljs-keyword">for</span> first, last <span class="hljs-keyword">in</span> name_tuples:
        full_names = full_names + [first + <span class="hljs-string">" "</span> + last]

    <span class="hljs-keyword">return</span> full_names
</code></pre></section>
</div></div>
<p></p><p><span id="queue_checkyourself_6"></span></p></div>
<p>However, even after removing the extra copying of strings, there is still another
instance of extra copying in the code! Another type of extra copying to watch
out for results from creating a new list during concatenation, rather than
adding values to an existing list through mutation.</p>
<p>The following example illustrates this difference:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">concat_copy</span>(<span class="hljs-params">list1, list2</span>):</span>
    list1 = list1 + list2
    <span class="hljs-keyword">return</span> list1

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">concat_mutate</span>(<span class="hljs-params">list1, list2</span>):</span>
    list1 += list2
    <span class="hljs-keyword">return</span> list1

a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
b = [<span class="hljs-number">4</span>, [<span class="hljs-number">5</span>]]
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"output: <span class="hljs-subst">{a=}</span> <span class="hljs-subst">{b=}</span>"</span>)
<span class="hljs-comment"># output: a=[1, 2, 3] b=[4, [5]]</span>

copy_result = concat_copy(a, b)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"output: <span class="hljs-subst">{a=}</span> <span class="hljs-subst">{b=}</span> <span class="hljs-subst">{copy_result=}</span>"</span>)
<span class="hljs-comment"># output: a=[1, 2, 3] b=[4, [5]] copy_result=[1, 2, 3, 4, [5]]</span>

mutate_result = concat_mutate(a, b)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{a=}</span> <span class="hljs-subst">{b=}</span> <span class="hljs-subst">{mutate_result=}</span>"</span>)
<span class="hljs-comment"># output: a=[1, 2, 3, 4, [5]] b=[4, [5]] mutate_result=[1, 2, 3, 4, [5]]</span>
</code></pre></section>
<p>During list concatenation <code>list1 = list1 + list2</code>, a new list is created that
makes a shallow copy of all of the elements in the two lists, that is then
stored in <code>list1</code>. If <code>list1</code> is very long and <code>list2</code> is short, a lot of extra
time will be spent copying the references to all the elements in <code>list1</code>.</p>
<p>On the other hand, during <code>list1 += list2</code>, <code>list1</code> is extended to contain
references to all of the elements in the second list. More details about these
operations can be found in the <a href="https://py.mit.edu/spring25/readings/environment_model#_concatenation">environment model reading</a>.</p>
<div class="question"><b>Check Yourself:</b><p></p><p>What will the code below print after executing the code above?</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">a[<span class="hljs-number">0</span>] -= <span class="hljs-number">1</span>
b[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] += <span class="hljs-number">10</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{a=}</span>, <span class="hljs-subst">{b=}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{copy_result=}</span>, <span class="hljs-subst">{mutate_result=}</span>"</span>)
</code></pre></section>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>The final two print statements will output:
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">a=[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, [<span class="hljs-number">15</span>]], b=[<span class="hljs-number">4</span>, [<span class="hljs-number">15</span>]]
copy_result=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, [<span class="hljs-number">15</span>]], mutate_result=[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, [<span class="hljs-number">15</span>]]
</code></pre></section>
<p>If this is surprising, try drawing an environment diagram!</p></div></div>
<p></p><p><span id="queue_checkyourself_7"></span></p></div>
<div class="question"><b>Check Yourself:</b><p></p><p>How would you resolve the last extra copying bug in <code>make_full_names</code>?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div><section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_full_names</span>(<span class="hljs-params">name_tuples</span>):</span>
    <span class="hljs-string">"""
    name_tuples is a list of tuples in the form of
    [("Kevin", "Bacon"), ("Tim, "Beaver"), ...]

    Returns a list of strings in the form of ["Kevin Bacon", "Tim Beaver", ... ]
    """</span>
    full_names = []

    <span class="hljs-keyword">for</span> first, last <span class="hljs-keyword">in</span> name_tuples:
        full_names += [first + <span class="hljs-string">" "</span> + last]
        <span class="hljs-comment"># or full_names.extend([first + " " + last])</span>
        <span class="hljs-comment"># or full_names.append(first + " " + last)</span>

    <span class="hljs-keyword">return</span> full_names
</code></pre></section></div></div>
<p></p><p><span id="queue_checkyourself_8"></span></p></div>
<p><a class="anchor" name="catsoop_section_2_1_5"></a><a class="anchor" name="_failing_to_hoist"></a></p><h4 class="cs_section_title">2.1.5) Failing to Hoist<a class="cs_permalink" href="#_failing_to_hoist">§</a></h4><p></p>


<ul>
<li><strong>Definition</strong>:
Performing a computation at every recursive step or loop iteration,
when a single computation external to the loop or recursive structure
would suffice.</li>
</ul>
<p>It may be best to demonstrate failing to hoist with an example. In the
code below, the <code>is_palindrome</code> function checks the type of the input <code>word</code>
during each recursive call, even though whether or not <code>word</code> is a <code>str</code> does
not change between calls.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_palindrome</span>(<span class="hljs-params">word</span>):</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> isinstance(word, str):
        <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">"Input must be a str"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> word:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">return</span> word[<span class="hljs-number">0</span>] == word[<span class="hljs-number">-1</span>] <span class="hljs-keyword">and</span> is_palindrome(word[<span class="hljs-number">1</span>:<span class="hljs-number">-1</span>])
</code></pre></section>
<p>The repeated type checking can be hoisted out of the recursive structure
by using a helper function, as shown below:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_palindrome</span>(<span class="hljs-params">word</span>):</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> isinstance(word, str):
        <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">"Input must be a str"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">helper</span>(<span class="hljs-params">word</span>):</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> word:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> word[<span class="hljs-number">0</span>] == word[<span class="hljs-number">-1</span>] <span class="hljs-keyword">and</span> helper(word[<span class="hljs-number">1</span>:<span class="hljs-number">-1</span>])

    <span class="hljs-keyword">return</span> helper(word)
</code></pre></section>
<p><a class="anchor" name="catsoop_section_2_1_6"></a><a class="anchor" name="_extra_loop_recursive_overhead"></a></p><h4 class="cs_section_title">2.1.6) Extra Loop / Recursive Overhead<a class="cs_permalink" href="#_extra_loop_recursive_overhead">§</a></h4><p></p>
<ul>
<li><strong>Definition</strong>:
Implementing multiple steps of an algorithm using similar loops or recursive
operations, when those steps could be combined more efficiently into one
loop or recursive operation.</li>
</ul>
<p>The <code>check_name_formats</code> function below checks for the <code>first</code> and <code>last</code> names
in separate <code>for</code> loops:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check_name_formats</span>(<span class="hljs-params">name_tuples</span>):</span>
    <span class="hljs-string">"""
    name_tuples is a list of tuples in the form of
    [("Kevin", "Bacon"), ("Tim, "Beaver"), ...]

    Returns whether the first letter of each first and last name
    is capitalized and that the remaining letters are lowercase
    """</span>

    <span class="hljs-keyword">for</span> first, last <span class="hljs-keyword">in</span> name_tuples:
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> str.isupper(first[<span class="hljs-number">0</span>]) <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> str.islower(first[<span class="hljs-number">1</span>:]):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-keyword">for</span> first, last <span class="hljs-keyword">in</span> name_tuples:
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> str.isupper(last[<span class="hljs-number">0</span>]):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
</code></pre></section>
<p>This not only costs more in loop overhead (since the list is iterated twice), but
here also means <a href="#_failing_to_short_circuit">failing to short circuit</a> if all the first names are properly formatted
but some last name is not.</p>
<p>The code below improves on the previous version by combining the two separate
loops for the <code>first</code> and <code>last</code> names into a single <code>for</code> loop.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check_name_formats</span>(<span class="hljs-params">name_tuples</span>):</span>
    <span class="hljs-string">"""
    Name tuples is a list of tuples in the form
    [("Kevin", "Bacon"), ("Tim, "Beaver"), ...]

    Returns whether the first letter of each first and last name
    is capitalized and that the remaining letters are lowercase
    """</span>

    <span class="hljs-keyword">for</span> first, last <span class="hljs-keyword">in</span> name_tuples:
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> str.isupper(first[<span class="hljs-number">0</span>]) <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> str.islower(first[<span class="hljs-number">1</span>:]):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> str.isupper(last[<span class="hljs-number">0</span>]):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
</code></pre></section>
<p><a class="anchor" name="catsoop_section_2_2"></a><a class="anchor" name="_suboptimal_data_structure_design"></a></p><h3 class="cs_section_title">2.2) Suboptimal Data Structure Design<a class="cs_permalink" href="#_suboptimal_data_structure_design">§</a></h3><p></p>
<p>Optimally structuring data often depends both on the information that is being
stored and the tasks that it is being used for. Designing efficient data
structures requires careful planning.</p>
<p><a class="anchor" name="catsoop_section_2_2_1"></a><a class="anchor" name="_slow_data_structure"></a></p><h4 class="cs_section_title">2.2.1) Slow Data Structure<a class="cs_permalink" href="#_slow_data_structure">§</a></h4><p></p>
<ul>
<li><strong>Definition</strong>:
Poor choice of data structure resulting in inefficient operations.</li>
</ul>
<p>When choosing a data structure for a program, it helps to
think about the most common operations the data will be used for. For example,
if frequent containment checks will be necessary, a <code>set</code> or <code>dict</code> may be most
effective, but if data is going to be added to a collection in order, a <code>list</code>
might be most appropriate.</p>
<p>For example, the following function returns the unique words from a collection of words.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_unique_words</span>(<span class="hljs-params">words</span>):</span>
    unique_words = []
    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:
        <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> unique_words:
            unique_words.append(word)
    <span class="hljs-keyword">return</span> unique_words
</code></pre></section>
<p>As discussed in the <a href="https://py.mit.edu/spring25/readings/flood_fill#_using_the_right_data_structure">Flood Fill reading</a>,
the convenience of the Python <code>in</code> keyword disguises the slow <code>list</code> containment
check operation. Using a <code>set</code> for <code>unique_words</code> leads to faster containment
checks, so it is better suited to this problem:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_unique_words</span>(<span class="hljs-params">words</span>):</span>
    unique_words = set()
    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:
        unique_words.add(word)
    <span class="hljs-keyword">return</span> unique_words
</code></pre></section>
<p>Conveniently, the <code>get_unique_words</code> function can be written much more simply
as follows:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_unique_words</span>(<span class="hljs-params">words</span>):</span>
    <span class="hljs-keyword">return</span> set(words)
</code></pre></section>
<p>The 6.101 course staff have noticed that using a <code>list</code> or <code>tuple</code> where using a
<code>set</code> would lead to more efficient operations is one of the most common
causes of slow data structure efficiency bugs.</p>
<p>&nbsp;</p>
<p>Sometimes, the provided data isn’t formatted well for solving a given problem.
Consider the following code:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">color_preferences = [
    (<span class="hljs-string">"Jaeyun"</span>, <span class="hljs-string">"blue"</span>),
    (<span class="hljs-string">"Paola"</span>, <span class="hljs-string">"blue"</span>),
    (<span class="hljs-string">"Nayra"</span>, <span class="hljs-string">"violet"</span>),
    (<span class="hljs-string">"Julia"</span>, <span class="hljs-string">"green"</span>),
    (<span class="hljs-string">"Mayu"</span>, <span class="hljs-string">"blue"</span>),
    (<span class="hljs-string">"Jack"</span>, <span class="hljs-string">"pink"</span>),
    (<span class="hljs-string">"Ximeng"</span>, <span class="hljs-string">"green"</span>),
    (<span class="hljs-string">"Shreya"</span>, <span class="hljs-string">"red"</span>),
    (<span class="hljs-string">"Kareem"</span>, <span class="hljs-string">"blue"</span>),
]

unique_colors = set([color <span class="hljs-keyword">for</span> _,color <span class="hljs-keyword">in</span> color_preferences])

<span class="hljs-keyword">for</span> color <span class="hljs-keyword">in</span> unique_colors:
    names = [name <span class="hljs-keyword">for</span> name, color_pref <span class="hljs-keyword">in</span> color_preferences <span class="hljs-keyword">if</span> color_pref == color]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"These people like <span class="hljs-subst">{color}</span>: <span class="hljs-subst">{names}</span>"</span>)
</code></pre></section>
<p>In order to go from the <code>color_preferences</code> list to the names of people with
each color preference, the code above repeatedly loops through <code>color_preferences</code>
for each color. While this does not pose a big problem for a small list of
<code>color_preferences</code>, if the list grew to hundreds of thousands or millions of
people, this would start to pose a greater issue.</p>
<div class="question"><b>Check Yourself:</b><p></p><p>What kind of data structure would allow us to more efficiently display
people's color preferences?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>In this case, a dictionary mapping a color to a list of people who prefer that
color will do the trick:
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">color_preferences = [
    (<span class="hljs-string">"Jaeyun"</span>, <span class="hljs-string">"blue"</span>),
    (<span class="hljs-string">"Paola"</span>, <span class="hljs-string">"blue"</span>),
    (<span class="hljs-string">"Nayra"</span>, <span class="hljs-string">"violet"</span>),
    (<span class="hljs-string">"Julia"</span>, <span class="hljs-string">"green"</span>),
    (<span class="hljs-string">"Mayu"</span>, <span class="hljs-string">"blue"</span>),
    (<span class="hljs-string">"Jack"</span>, <span class="hljs-string">"pink"</span>),
    (<span class="hljs-string">"Ximeng"</span>, <span class="hljs-string">"green"</span>),
    (<span class="hljs-string">"Shreya"</span>, <span class="hljs-string">"red"</span>),
    (<span class="hljs-string">"Kareem"</span>, <span class="hljs-string">"blue"</span>),
]

color_preference_dict = {}

<span class="hljs-keyword">for</span> name, color <span class="hljs-keyword">in</span> color_preferences:
    <span class="hljs-keyword">if</span> color <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> color_preference_dict:
        color_preference_dict[color] = []
    color_preference_dict[color].append(name)

<span class="hljs-keyword">for</span> color <span class="hljs-keyword">in</span> color_preference_dict:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"These people like <span class="hljs-subst">{color}</span>: <span class="hljs-subst">{color_preference_dict[color]}</span>"</span>)
</code></pre></section>
<p>Adding additional computation to store the color preferences in a <code>dict</code>
eliminates all but one iteration through the original <code>color_preferences</code> list.</p></div></div>
<p></p><p><span id="queue_checkyourself_9"></span></p></div>
<p><a class="anchor" name="catsoop_section_2_2_2"></a><a class="anchor" name="_expensive_data_transformation"></a></p><h4 class="cs_section_title">2.2.2) Expensive Data Transformation<a class="cs_permalink" href="#_expensive_data_transformation">§</a></h4><p></p>
<ul>
<li><strong>Definition</strong>:
The amount of time taken to create a data structure is significantly greater
than the amount of time saved by using this new structure.</li>
</ul>
<p>There is a tradeoff between time spent transforming data and the time spent
interacting with data. As shown in the previous section, effective data
transformations may take some extra initial computation, but can greatly
improve the overall efficiency of a program, especially when common operations
will be repeated many times. In some cases, however, the
time taken to transform data outweighs the efficiency gains from the transformation.</p>
<p>The code below precomputes the positive factors of a million integers.
In cases where these factors were used many times, this could be useful, but in
this case, where a human is entering in the input manually, it is likely that
precomputing a million answers will lead to a lot of wasted computation.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_positive_factors</span>(<span class="hljs-params">x</span>):</span>
    factors = set()
    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, int(x ** <span class="hljs-number">0.5</span>) + <span class="hljs-number">1</span>):
        <span class="hljs-keyword">if</span> x % num == <span class="hljs-number">0</span>:
            factors.add(num)
            factors.add(x // num)
    <span class="hljs-keyword">return</span> factors

factor_map = {num : get_positive_factors(num) <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>_000_001)}

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-keyword">try</span>:
        x = int(input(<span class="hljs-string">"Enter a positive integer between 1 and 1,000,000: "</span>))
    <span class="hljs-keyword">except</span> ValueError:
        <span class="hljs-keyword">break</span>

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">1</span> &lt;= x &lt;= <span class="hljs-number">1</span>_000_000:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"The integer must be between 1 and 1,000,000 \n"</span>)
        <span class="hljs-keyword">continue</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"The factors of <span class="hljs-subst">{x}</span> are: <span class="hljs-subst">{<span class="hljs-string">', '</span>.join(str(num) <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> factor_map[x])}</span>\n"</span>)

</code></pre></section>
<div class="question"><b>Check Yourself:</b><p></p><p>How would you restructure the code to avoid the expensive data transformation?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>One way to fix this is to compute and cache the factors only as needed as shown
in this code:
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_positive_factors</span>(<span class="hljs-params">x</span>):</span>
    factors = set()
    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, int(x ** <span class="hljs-number">0.5</span>) + <span class="hljs-number">1</span>):
        <span class="hljs-keyword">if</span> x % num == <span class="hljs-number">0</span>:
            factors.add(num)
            factors.add(x // num)
    <span class="hljs-keyword">return</span> factors

factor_map = {}

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-keyword">try</span>:
        x = int(input(<span class="hljs-string">"Enter a positive integer between 1 and 1,000,000: "</span>))
    <span class="hljs-keyword">except</span> ValueError:
        <span class="hljs-keyword">break</span>

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">1</span> &lt;= x &lt;= <span class="hljs-number">1</span>_000_000:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"The integer must be between 1 and 1,000,000 \n"</span>)
        <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">if</span> x <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> factor_map:
        factor_map[x] = get_positive_factors(x)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"The factors of <span class="hljs-subst">{x}</span> are: <span class="hljs-subst">{<span class="hljs-string">', '</span>.join(str(num) <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> factor_map[x])}</span>\n"</span>)
</code></pre></section>
<p>Notice that we are still using <code>factor_map</code> as a <a href="#_failing_to_cache">cache</a>, to avoid recomputing the factors of a number we've already seen.  But getting rid of <code>factor_map</code> and computing the factors each time a number is
entered would also work, assuming that a human user isn't likely to ask for the same
numbers over and over again.</p></div></div>
<p></p><p><span id="queue_checkyourself_10"></span></p></div>
<p>If you are unsure whether a data transformation is too expensive,
you can use <code>time.time()</code> to determine how long the
transformation takes and how long the actual operation takes.</p>
<p><a class="anchor" name="catsoop_section_2_3"></a><a class="anchor" name="_suboptimal_algorithm_design"></a></p><h3 class="cs_section_title">2.3) Suboptimal Algorithm Design<a class="cs_permalink" href="#_suboptimal_algorithm_design">§</a></h3><p></p>
<p>Different solutions to the same problem may be appropriate for different contexts.
As mentioned in the introduction, a slow sorting algorithm may work well for
small cases, but more efficient sorting algorithms become necessary as the data size
scales up. Whereas superfluous computations tend to be low-level efficiency bugs
that can be solved with small adjustments to existing code, suboptimal algorithm
design may require making more substantial changes to the code as a result of
changing the higher-level algorithm.</p>
<p>The first three subcategories of suboptimal algorithm design can be fixed
with algorithm optimizations or more effective use of problem constraints.
The last subcategory is more language specific: reimplementing builtins
reduces performance for Python programs and may result in
slowdowns in other languages as well, depending on their implementation.</p>
<p><a class="anchor" name="catsoop_section_2_3_1"></a><a class="anchor" name="_solving_irrelevant_subproblems"></a></p><h4 class="cs_section_title">2.3.1) Solving Irrelevant Subproblems<a class="cs_permalink" href="#_solving_irrelevant_subproblems">§</a></h4><p></p>
<ul>
<li><strong>Definition</strong>:
A brute-force approach involving solving unnecessary subproblems before
checking constraints.</li>
</ul>
<p>Consider the <code>get_valid_moves</code> function that finds the <code>valid_moves</code> from
a <code>current_loc</code>, avoiding obstacles.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_all_locations</span>(<span class="hljs-params">board</span>):</span>
    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> range(board[<span class="hljs-string">"rows"</span>]):
        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> range(board[<span class="hljs-string">"cols"</span>]):
            <span class="hljs-keyword">yield</span> (r, c)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_valid_moves</span>(<span class="hljs-params">board, current_loc</span>):</span>
    <span class="hljs-string">"""
    Gets valid_moves from current_loc
    A valid move must be in bounds and adjacent horizontally
    or vertically to the current_loc and not be on an obstacle

    inputs:

    board = {
        "rows" : 5,
        "cols" : 6,
        "obstacles" : {(0, 0), (3, 0), (2, 5)}, # (row, col)
    }
    current_loc = (1, 5)

    output: {(1, 4), (0, 5)}
    """</span>
    valid_moves = set()
    <span class="hljs-keyword">for</span> r, c <span class="hljs-keyword">in</span> get_all_locations(board):
        <span class="hljs-keyword">if</span> (r, c) <span class="hljs-keyword">in</span> board[<span class="hljs-string">"obstacles"</span>]:
            <span class="hljs-keyword">continue</span>
        <span class="hljs-comment"># move must be directly above or to the side of current_loc</span>
        distance = abs(r - current_loc[<span class="hljs-number">0</span>]) + abs(c - current_loc[<span class="hljs-number">1</span>])
        <span class="hljs-keyword">if</span> distance == <span class="hljs-number">1</span>:
            valid_moves.add((r, c))
    <span class="hljs-keyword">return</span> valid_moves
</code></pre></section>
<p>In the code above, generating and looping through all the locations before
checking the constraint of the move being directly adjacent to the
<code>current_loc</code> is an example of unnecessary brute force. The moves that are not
directly adjacent horizontally or vertically to <code>current_loc</code> do not need to be
explored at all, so generating and checking each of these distant locations is
irrelevant.</p>
<div class="question"><b>Check Yourself:</b><p></p><p>How would you refactor <code>get_valid_moves</code>?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div><p>The approach shown here uses the constraint that <code>valid_moves</code> must be directly
adjacent to the <code>current_loc</code> in order to only explore viable neighboring moves.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_valid_moves</span>(<span class="hljs-params">board, current_loc</span>):</span>
    valid_moves = set()

    <span class="hljs-keyword">for</span> row_delta, col_delta <span class="hljs-keyword">in</span> ((<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>)):
        r = current_loc[<span class="hljs-number">0</span>] + row_delta
        c = current_loc[<span class="hljs-number">1</span>] + col_delta
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ( <span class="hljs-number">0</span> &lt;= r &lt; board[<span class="hljs-string">"rows"</span>] ):
            <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ( <span class="hljs-number">0</span> &lt;= c &lt; board[<span class="hljs-string">"cols"</span>] ):
            <span class="hljs-keyword">continue</span>
        move = (r,c)
        <span class="hljs-keyword">if</span> move <span class="hljs-keyword">in</span> board[<span class="hljs-string">"obstacles"</span>]:
            <span class="hljs-keyword">continue</span>
        valid_moves.add(move)

    <span class="hljs-keyword">return</span> valid_moves
</code></pre></section>
</div></div>
<p></p><p><span id="queue_checkyourself_11"></span></p></div>
<p>&nbsp;</p>
<p>However, the utility of writing brute force approaches to problem solving should
not be fully discounted. It is often helpful to write a correct solution to a
problem (even if it is slow) before figuring out a more efficient solution as
needed. Sometimes, this means writing a preliminary brute force approach and
then applying problem constraints to a faster future version.</p>
<p><a class="anchor" name="catsoop_section_2_3_2"></a><a class="anchor" name="_misordering_subproblems"></a></p><h4 class="cs_section_title">2.3.2) Misordering Subproblems<a class="cs_permalink" href="#_misordering_subproblems">§</a></h4><p></p>
<ul>
<li><strong>Definition</strong>:
Failing to explore subproblems according to a valid heuristic, when doing
so would lead to performance gains.</li>
</ul>
<p>Typically, a <a href="https://en.wikipedia.org/wiki/Heuristic_(computer_science)">heuristic</a>
technique involves a ranking of items to explore, such that items which are more
likely to lead to a solution are ranked higher, and explored first. For example,
the popular word game <a href="https://en.wikipedia.org/wiki/Wordle">Wordle</a> involves
guessing a five-letter word in as few guesses as possible. Each time you guess
a word, you gain information about which letters are correct, which letters are
in the word but in the wrong location, and which letters are incorrect. A good
heuristic to help solve the subproblem of unknown letters within the word might
involve selecting a word that has distinct letters that haven't been used in
previous guesses but are commonly found in five-letter words. For example,
a word like "raise" may be a good first guess because it contains five distinct
common letters, while "esses" may be less wise because it contains only two
distinct letters.</p>
<p>More concretely, in the following example, suppose <code>shortest_to_longest</code> is a list of the words
found in Mary Shelly's <em>Frankenstein</em> sorted in ascending order by length. The
goal of the code is to identify the longest word in <em>Frankenstein</em> starting with
the letter 'z'.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-comment"># explore words from shortest to longest by length</span>
<span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> shortest_to_longest:
    <span class="hljs-keyword">if</span> word[<span class="hljs-number">0</span>] == <span class="hljs-string">"z"</span>:
        longest_z_word = word

<span class="hljs-built_in">print</span>(longest_z_word)
</code></pre></section>
<p>This code has the subproblem of finding the words in the book that start with
the desired letter "z". However, exploring the words from shortest to longest
means we are exploring some of the least likely words first. If instead we used
a heuristic like exploring the longest words first, we could
potentially avoid looking through all the words, because the first word found
starting with 'z' would also be the longest word starting with 'z'.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-comment"># explore words from longest to shortest by length</span>
<span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> reversed(shortest_to_longest):
    <span class="hljs-keyword">if</span> word[<span class="hljs-number">0</span>] == <span class="hljs-string">"z"</span>:
        longest_z_word = word
        <span class="hljs-keyword">break</span>

<span class="hljs-built_in">print</span>(longest_z_word)
</code></pre></section>
<p>However, if there are no words starting with 'z' in all of <em>Frankenstein</em>, both
solutions would have to check all the words. (This is not the case;
<em>Frankenstein</em> uses the word "zeal" four times.) While iterating through words
from longest to shortest will not lead to performance gains for all books or
individual letters, for most general cases, this change will significantly
improve efficiency.</p>
<p><a class="anchor" name="catsoop_section_2_3_3"></a><a class="anchor" name="_repeatedly_solving_subproblems"></a></p><h4 class="cs_section_title">2.3.3) Repeatedly Solving Subproblems<a class="cs_permalink" href="#_repeatedly_solving_subproblems">§</a></h4><p></p>
<ul>
<li><strong>Definition</strong>:
Re-exploring parts of the problem space.</li>
</ul>
<p>Consider the problem of finding all the pairwise sums of numbers in a list called <code>nums</code>:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">all_pairwise_sums = set()

<span class="hljs-keyword">for</span> num1 <span class="hljs-keyword">in</span> nums:
    <span class="hljs-keyword">for</span> num2 <span class="hljs-keyword">in</span> nums:
        all_pairwise_sums.add(num1 + num2)
</code></pre></section>
<p>This code is doing about twice as much work as it has to, because addition is commutative.
Suppose that <code>nums = [1, 2, 4, 7, 13]</code>. Then, the code above will add both <code>2 + 13</code>
and <code>13 + 2</code> to <code>all_pairwise_sums</code>. By adjusting the index of the first
<code>num2</code> element, this duplicate computation can be eliminated:</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">all_pairwise_sums = set()

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(nums)):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(i, len(nums)):
        all_pairwise_sums.add(nums[i] + nums[j])
</code></pre></section>
<p>However, sometimes we need to keep track of which subproblems we have solved in
order to avoid re-solving them. This is the purpose of using a visited set, as
discussed in the <a href="https://py.mit.edu/fall24/readings/flood_fill">Flood Fill reading</a>.
Later on, the <a href="https://py.mit.edu/fall24/readings/functional_programming#_memoization">Functional Programming</a>
reading discusses the concept of <a href="https://en.wikipedia.org/wiki/Memoization">memoization</a>,
which is when a function caches the answers to inputs to avoid re-computing the
answer when it comes across an input it has seen previously. For the purposes
of 6.101, memoization is a useful technique but is not emphasized in the labs.</p>
<p><a class="anchor" name="catsoop_section_2_3_4"></a><a class="anchor" name="_reimplementing_builtins"></a></p><h4 class="cs_section_title">2.3.4) Reimplementing Builtins<a class="cs_permalink" href="#_reimplementing_builtins">§</a></h4><p></p>
<ul>
<li><strong>Definition</strong>:
Implementing an algorithm instead of using a more efficient builtin.</li>
</ul>
<p>Because CPython, the default Python interpreter, implements Python builtin
functions such as <code>sum</code> or <code>max</code> in the C language (which is much faster),
using builtins rather than reimplementing equivalent functionality in Python
usually leads to faster code.</p>
<p>The code below finds the maximum value in a list of numbers.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted">
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">max_num</span>(<span class="hljs-params">nums</span>):</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> nums:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"nums argument is empty"</span>)

    best = nums[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> nums:
        <span class="hljs-keyword">if</span> num &gt; best:
            best = num
    <span class="hljs-keyword">return</span> best

</code></pre></section>
<p>The <code>max_num</code> function has nearly identical behavior to the builtin <code>max</code>
function. Using the Python <code>time</code> module, the time difference between the
builtin and reimplemented <code>max</code> function can be seen.</p>
<section aria-label="Code block"><pre><code class="language-py hljs python highlighted"><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint
<span class="hljs-keyword">import</span> time


nums = [randint(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span class="hljs-number">1000</span>)]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">max_num</span>(<span class="hljs-params">nums</span>):</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> nums:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"max_num() nums argument is empty"</span>)

    best = nums[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> nums:
        <span class="hljs-keyword">if</span> num &gt; best:
            best = num
    <span class="hljs-keyword">return</span> best


start_time = time.time()

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>_000):
    x = max_num(nums)

end_time = time.time()
total_time_reimplemented = end_time - start_time
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{total_time_reimplemented=}</span>"</span>)


start_time = time.time()

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>_000):
    x = max(nums)

end_time = time.time()
total_time_builtin = end_time - start_time
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{total_time_builtin=}</span>"</span>)
</code></pre></section>
<p>Running the code above produces the following:</p>
<section aria-label="Code block"><pre><code class="nohighlight highlighted">total_time_reimplemented=2.5645499229431152
total_time_builtin=0.8306694030761719
</code></pre></section>
<p>&nbsp;</p>
<p>Reimplementing builtins can be a great way to learn how to program, but if
efficiency is important for the task at hand, using builtins is the way to go.</p>
<p><a class="anchor" name="catsoop_section_3"></a><a class="anchor" name="_finding_and_fixing_efficiency_bugs"></a></p><h2 class="cs_section_title">3)  Finding and Fixing Efficiency Bugs <a class="cs_permalink" href="#_finding_and_fixing_efficiency_bugs">§</a></h2><p></p>
<p>The previous section spent a lot of time discussing ways common efficiency bugs
arise and how to fix them. Even with this knowledge, the art of
optimizing and speeding up code can be a very complex task and can even be more
difficult than getting the code correct in the first place, so try not to feel
discouraged when it proves difficult to speed things up. However, approaching
efficiency bugs in a systematic way can help you find and fix them, especially
when you have a large program with many interconnected pieces. The following
steps can help make the efficiency bug finding and fixing process more systematic:</p>
<ol>
<li>Time your code</li>
<li>Make a list of potential slow functions or blocks of code</li>
<li>Make a list of efficiency bug hypotheses and possible fixes within these places</li>
<li>Select your best hypothesis and implement the fix</li>
<li>Time your code again (and note the difference!)</li>
</ol>
<p>These steps are explained in greater detail in the following sections.</p>
<p><a class="anchor" name="catsoop_section_3_1"></a><a class="anchor" name="_time_your_code"></a></p><h3 class="cs_section_title">3.1)  Time your code <a class="cs_permalink" href="#_time_your_code">§</a></h3><p></p>
<p>The first step to timing your code is to determine what exactly you are timing.
In the context of 6.101 labs, this is generally going to be a specific test case
that is already passing, but runs slowly or it might be a test case that runs
seemingly forever (despite passing the tests for simpler inputs.)</p>
<p>As discussed in the <a href="https://py.mit.edu/spring25/readings/command_line#_running_pytest">Command Line reading</a>
running <code>pytest -k TEST_NAME test.py</code> will allow you to select a specific test
case to run. Adding the <code>-s</code> flag (i.e., <code>pytest -k TEST_NAME test.py -s</code>)
will allow you to see the print statements for a test case as it is running.</p>
<p>Once you have isolated a specific test case, put <code>time.time()</code> and <code>print</code> statements in your code to measure the parts you want to learn about.
The <a href="https://py.mit.edu/spring25/readings/flood_fill/#_timing_the_program">Flood Fill reading</a> demonstrates this, and <a href="#_reimplementing_builtins">another example</a> is found earlier in this reading.</p>
<p>It is generally a
good idea to run the program a few times to get a sense of how long the program
actually takes. Remember to write the time down so that you can compare it to
later versions of your program to see whether there was any improvement.</p>
<p>In general, the submission server is going to give you more consistent
timing data than your computer, but it also has timeouts. If you hit the timeout
you don't know exactly how long your code would take to finish running, so do
not use the timeout limit as your time. Instead, it may be useful to note how
many test cases passed within the time limit, or what test case was running when
the timeout occurred. Also different machines run code faster or slower so when
you time your code, make sure to use the same computer (control that variable in your experiment!)</p>
<div class="callout callout-note"><div class="callout-title">NOTE about <code>time.time()</code></div>
<p>Throughout some of the explanations above, we have used Python's <code>time.time()</code> function to
measure the runtime of various pieces of code.</p><p>While this will be useful as a <strong>rough</strong> measure of runtime, note that using
a single real-time runtime to determine a program's overall performance can be very
misleading. This is because the real-time runtime of a piece of code can vary
wildly, especially for small programs, as some machines are simply faster than
others. And factors beyond your control can cause varied runtimes even on the
same machine running the same code repeatedly. (For example, if the operating
system is running many programs in the background, the Python program may run
more slowly.)</p><p>To minimize the impact of this variance, it is a good idea to run the code
multiple times and take an average of the trials. This is why for
many of the small examples above, we calculated the runtime by repeating the
operation thousands of times. As you make changes to your code
running more repeated trials will allow you to determine whether your code's
average runtime has substantially decreased or increased.</p><p>There are other reliable ways of evaluating the efficiency of programs that
don't involve measuring the code's runtime, but 6.101 does not focus on those
methods.<a class="anchor" name="catsoop_footnote_ref_1"></a><a href="#catsoop_footnote_1"><sup>1</sup></a></p>
</div>
<p><a class="anchor" name="catsoop_section_3_2"></a><a class="anchor" name="_make_a_list_of_potential_slow_functions"></a></p><h3 class="cs_section_title">3.2)  Make a list of potential slow functions <a class="cs_permalink" href="#_make_a_list_of_potential_slow_functions">§</a></h3><p></p>
<p>After timing your code, inspect the program you are running. What functions does
the test case call, and do those functions use any helper functions? From this
information, you can start to guess at what functions or places within the functions
are taking the most time.</p>
<p>If you are not certain about which function is causing the slowdown you can
collect more time data on individual functions. While <code>pytest</code> will report how
much time it took to run the test overall, you may also want to use print
statements and the <code>time</code> module as shown in the previous examples to
get more specific timing details about specific functions that you think might
be slow.</p>
<p>After you have at least one or two places in mind that
may be sources of efficiency bugs, move on to the next step.</p>
<p><a class="anchor" name="catsoop_section_3_3"></a><a class="anchor" name="_make_a_list_of_efficiency_bug_hypotheses"></a></p><h3 class="cs_section_title">3.3)  Make a list of efficiency bug hypotheses <a class="cs_permalink" href="#_make_a_list_of_efficiency_bug_hypotheses">§</a></h3><p></p>
<p>For each piece of slow code, make hypotheses for what specific efficiency bugs
may be causing the slowdown. Start with superfluous computation and data
transformations, because those tend to be easier to spot and fix. If you can
rule those out, it may be time to think about your larger algorithm and why it
might be suboptimal. For each efficiency bug hypothesis, think about what it
would take to fix this bug.</p>
<p><a class="anchor" name="catsoop_section_3_4"></a><a class="anchor" name="_select_your_best_hypothesis_and_implement_the_fix"></a></p><h3 class="cs_section_title">3.4)  Select your best hypothesis and implement the fix <a class="cs_permalink" href="#_select_your_best_hypothesis_and_implement_the_fix">§</a></h3><p></p>
<p>Take your best potential efficiency bug (either the one that is the easiest
to fix or the one you think will lead to the biggest performance improvement)
and implement it. It is usually a good idea to save the original code in a
separate file, in case you need to go back to this version of the code.</p>
<p><a class="anchor" name="catsoop_section_3_5"></a><a class="anchor" name="_time_your_code_again_and_note_the_difference"></a></p><h3 class="cs_section_title">3.5)  Time your code again (and note the difference) <a class="cs_permalink" href="#_time_your_code_again_and_note_the_difference">§</a></h3><p></p>
<p>Finally, determine if the change made things faster or slower by timing your
code again on the same tests on the same machine. Note the difference between
this time and your original code time.</p>
<p>Big efficiency bug fixes should be apparent on the first run (generally
improvements that make ≥ 1 second or ≥ 10% improvements). Small
improvements may require a few measurements to see if it truly made a difference.</p>
<p>If the code turns out to be <em>slower</em> instead (which happens sometimes!), then revert to the previous version and go back to selecting
a new hypothesis.</p>
<p>If the code still passes the test and is faster (hooray!),
determine whether you need to continue making the code more efficient by
submitting to the server. If the code still needs to run faster, go back to
collecting more time data and selecting a different function or a different
hypothesis. Note that the same piece of code may contain multiple different
kinds of efficiency bugs!</p>
<p><a class="anchor" name="catsoop_section_4"></a><a class="anchor" name="_conclusion"></a></p><h2 class="cs_section_title">4)  Conclusion <a class="cs_permalink" href="#_conclusion">§</a></h2><p></p>
<p>This reading has described some of the most common efficiency bugs that 6.101 course staff
have observed in student code across three general categories of superfluous
computation, suboptimal data structure, and suboptimal algorithm. Being aware
of these categories will aid you as you systematically time, identify, and fix
potential sources of efficiency bugs both in 6.101 and in the future programs
that you work with.<a class="anchor" name="catsoop_footnote_ref_2"></a><a href="#catsoop_footnote_2"><sup>2</sup></a>
<script type="text/javascript">
        if (MathJax) {
            // Disable the MathJax right-click menu,
            // so that screenreader doesn't say "clickable" on every math element
            // Based on https://docs.mathjax.org/en/latest/web/configuration.html#configuring-mathjax-after-it-is-loaded
            MathJax.config.options = MathJax.config.options ?? {};
            MathJax.config.options.enableMenu = false;
            MathJax.startup.getComponents();
        }


        // give the hamburger menu icon an accessible label
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector("a.icon")?.setAttribute('aria-label', 'site-menu');
        });
        
        // based on catsoop.modal
        catsoop.vprof_survey = function (header, text, vprof_link, link_timestamp) {
          return new Promise(function (resolve, reject) {
            var response = {
            "response": null,
            "vprof_link": vprof_link,
            "link_timestamp": link_timestamp,
            "response_timestamp": null,
            "make_modal_timestamp": Date.now(),
            };
            var content = document.createElement("dialog");
            content.classList = ["catsoop-modal-content"];
            content.setAttribute("aria-labelledby", "catsoop-dialog-header");
            content.setAttribute("aria-describedby", "catsoop-dialog-body");
            content.addEventListener("keydown", function (e) {
              // this piece traps focus in the dialog while it is open
              // based on https://hidde.blog/using-javascript-to-trap-focus-in-an-element/
              if (!content.open) {
                return;
              }
              if (e.key === "Tab" || e.keyCode === 9) {
                if (e.shiftKey) {
                  if (document.activeElement === content.focusable[0]) {
                    content.focusable[content.focusable.length - 1].focus();
                    e.preventDefault();
                  }
                } else if (
                  document.activeElement ===
                  content.focusable[content.focusable.length - 1]
                ) {
                  content.focusable[0].focus();
                  e.preventDefault();
                }
              }
            });
            content.focusable = [];

            var mbody = document.createElement("div");
            mbody.classList = ["catsoop-modal-body"];

            var close_button = document.createElement("button");
            close_button.classList = ["catsoop-modal-close"];
            close_button.innerHTML = "&times;";
            close_button.setAttribute("aria-label", "Close");
            close_button.onclick = function () {
              content.close(JSON.stringify(Object.assign(response, {"response": "cancel", "response_timestamp": Date.now()})));
            };
            content.focusable.push(close_button);
            mbody.append(close_button);

            var title = document.createElement("span");
            title.id = "catsoop-dialog-header";
            title.classList = ["catsoop-modal-header"];
            title.appendChild(document.createTextNode(header));
            title.setAttribute("role", "heading");
            mbody.appendChild(title);

            var body = document.createElement("p");
            body.id = "catsoop-dialog-body";
            body.innerHTML = text + "<br/>";
            mbody.appendChild(body);

            var buttons = document.createElement("span");
            var yes_button = document.createElement("button");
            yes_button.innerText = "Yes";
            yes_button.classList = ["btn btn-catsoop"];
            yes_button.addEventListener("click", function () {
              content.close(JSON.stringify(Object.assign(response, {"response": "yes", "response_timestamp": Date.now()})));
            });
            yes_button.setAttribute("autofocus", true);
            content.focusable.push(yes_button);


            var no_button = document.createElement("button");
            no_button.innerText = "No";
            no_button.classList = ["btn btn-catsoop"];
            no_button.addEventListener("click", function () {
              content.close(JSON.stringify(Object.assign(response, {"response": "no", "response_timestamp": Date.now()})));
            });
            content.focusable.push(no_button);

            buttons.appendChild(yes_button);
            buttons.appendChild(document.createTextNode(" "));
            buttons.appendChild(no_button);
            mbody.appendChild(buttons);

            content.addEventListener("close", function () {
              content.remove();
              last_clicked_vprof_report[0] = null;
              last_clicked_vprof_report[1] = null;
              showing_vprof_survey[0] = false;
              (content.returnValue === "" ? reject : resolve)(content.returnValue);
            });

            content.appendChild(mbody);
            document.body.appendChild(content);
            content.showModal();
          });
        };


        function postVprofSurveyResponse(value){
            var data = JSON.parse(value);
            var encoded_form_pairs = [];
            for (var name in data){
                encoded_form_pairs.push(encodeURIComponent(name) + '=' + encodeURIComponent(data[name]));
            }
            //console.log("data", data)
            var form = encoded_form_pairs.join('&').replace(/%20/g, '+');
            //console.log("form data", form);

            var request = new XMLHttpRequest();
            request.onload = function(){
                var msg = request.response;
                var data = JSON.parse(msg);
                //if(data.ok){
                //    console.log("post success")
                //}else{
                //    concole.log("post error", msg, JSON.stringify(data))
                //}
            }

            request.open('POST', "https://py.mit.edu/spring25/staffonly/analytics/vprof_survey_collector", true);
            request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            request.send(form);

        }

        var showing_vprof_survey = [false];
        var last_clicked_vprof_report = [null, null];

        document.addEventListener('visibilitychange', e=>{
          if (document.visibilityState === 'visible' &&
              last_clicked_vprof_report[0] !== null &&
              !showing_vprof_survey[0]) {
              // show vorif yes/no survey
              catsoop.vprof_survey("vprof survey",
                "Did <a href='" + last_clicked_vprof_report[0] + "' target='_blank'> this vprof report</a> help you find and/or fix an efficiency bug?",
                last_clicked_vprof_report[0], last_clicked_vprof_report[1]).then(postVprofSurveyResponse, postVprofSurveyResponse);
              showing_vprof_survey[0] = true;
            }
        })

        var vprof_links  = document.getElementsByClassName("vprof_link");
        for (var i=0; i < vprof_links.length; i++) {
            let my_link = vprof_links[i].href
            if ((typeof my_link === 'string' || my_link instanceof String) && !my_link.includes("#")) {
                vprof_links[i].href = my_link + '#78111110101-50b7ffceb795e65fe8dba48b66ad8351b38526a56061272e905a62a2839c2975';
            }
            vprof_links[i].onclick = function(){
              last_clicked_vprof_report[0] = this.href;
              last_clicked_vprof_report[1] = Date.now();
            }
        }


    </script>
<script type="text/javascript">
catsoop.callbacks['submit'] = function(ok, names, status, response){
    response = JSON.parse(response);
    if (response[names[0]].score == 1){
        document.getElementById(names[0] + '_viewanswer').click();
    }
}
</script></p>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
catsoop.all_questions = [];
catsoop.username = 'tjampa';
catsoop.this_path = 'https://py.mit.edu/spring25/readings/efficiency';
catsoop.path_info = ['spring25', 'readings', 'efficiency'];
catsoop.course = 'spring25';
catsoop.url_root = 'https://py.mit.edu';

// @license-end</script>
<div id="cs_footnotes"><br>&nbsp;<hr><b name="cs_footnotes">Footnotes</b><p><a class="anchor" name="catsoop_footnote_1"></a><sup style="padding-right:0.25em;color:var(--cs-base-bg-color);">1</sup>However, 6.121 (Introduction to Algorithms) and other theory courses
cover this topic in much more detail! <a href="#catsoop_footnote_ref_1"><span class="noprint">(click to return to text)</span></a></p><p><a class="anchor" name="catsoop_footnote_2"></a><sup style="padding-right:0.25em;color:var(--cs-base-bg-color);">2</sup>For those interested in learning more about efficiency,
6.106 Performance Engineering provides an in depth journey into the rabbit hole
of speeding up code. <a href="#catsoop_footnote_ref_2"><span class="noprint">(click to return to text)</span></a></p></div>
</div>
</div>
<div class="cs_right_menu"></div>
</div>
<footer>
<nav aria-label="Breadcrumbs" class="cs_navigation cs_bottom_navigation" id="cs_bottom_navigation"><li><a href="https://py.mit.edu/spring25">Home</a></li><li><a href="https://py.mit.edu/spring25/readings">Course Readings</a></li><li><a href="https://py.mit.edu/spring25/readings/efficiency">Efficiency</a></li></nav>
<div class="cs_footer">
      This page was last updated on Thursday January 30, 2025 at 08:01:34 AM (revision <code>c3f6dbd3</code>).<br>&nbsp;<br>
<center><img src="Efficiency%20_%20Course%20Readings%20_%206.101%20Spring%202025_files/cc-by-sa.svg" style="width: 2cm;"></center><div style="max-width: 600px; margin-bottom:1em; margin-left:auto; margin-right:auto;">Except where otherwise noted, these readings are licensed under a<br><a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" target="_blank">Creative Commons&nbsp;BY-SA&nbsp;4.0</a> license.  Portions of the readings were derived from<br>or inspired by the <a href="https://web.mit.edu/6.031/www/sp25/" target="_blank">6.031 Course Notes</a>, the <a href="https://hz.mit.edu/catsoop/6.145" target="_blank">6.145 Course Notes</a>, and the 6.01 Course Notes.
</div>
<pre class="catsooplogo" style="font-size:50%;">\            
/    /\__/\  
\__=(  o_O )=
(__________) 
 |_ |_ |_ |_ </pre>
      Powered by <a href="https://catsoop.org/" target="_blank">CAT-SOOP</a> v19.0.6+hg.14.f36ce1d1 "Korat" (LTS) (development snapshot).<br>
      CAT-SOOP is <a href="https://www.fsf.org/about/what-is-free-software" target="_blank">Free/Libre Software</a>, available under the terms<br>of the <a href="https://py.mit.edu/_util/license" target="_blank">GNU Affero General Public License, version 3</a>.<br>
<a download="" href="https://py.mit.edu/_util/source.zip" target="_blank">Download Source Code</a><br>
<a href="https://py.mit.edu/_util/jslicense.html" rel="jslicense" target="_blank">Javascript License Information</a>
</div>
</footer>



</body></html>